/* Tiny tinycomments plugin
*
* Copyright 2010-2018 Tiny Technologies Inc. All rights reserved.
*
* Version: 2.1.1-89
*/
!function(b){"use strict";var y=function(){},v=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,n))}},W=function(n){return function(){return n}},s=function(n){return n};function l(r){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=o.concat(n);return r.apply(null,t)}}var n,e,t,r,o,w,i,u=function(n){return function(){throw new Error(n)}},a=W(!1),c=W(!0),O=W("dismiss.popups"),f=a,d=c,m=function(){return g},g=(r={fold:function(n,e){return n()},is:f,isSome:f,isNone:d,getOr:t=function(n){return n},getOrThunk:e=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:t,orThunk:e,map:m,ap:m,each:function(){},bind:m,flatten:m,exists:f,forall:d,filter:m,equals:n=function(n){return n.isNone()},equals_:n,toArray:function(){return[]},toString:W("none()")},Object.freeze&&Object.freeze(r),r),p=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:d,isNone:f,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return p(n(t))},ap:function(n){return n.fold(m,function(n){return p(n(t))})},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:g},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(f,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},A={some:p,none:m,from:function(n){return null==n?g:p(n)}},h=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:W(n)}},x={fromHtml:function(n,e){var t=(e||b.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw b.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return h(t.childNodes[0])},fromTag:function(n,e){var t=(e||b.document).createElement(n);return h(t)},fromText:function(n,e){var t=(e||b.document).createTextNode(n);return h(t)},fromDom:h,fromPoint:function(n,e,t){var r=n.dom();return A.from(r.elementFromPoint(e,t)).map(h)}},_=function(m,g){return function(n){if(m(n)){var e,t,r,o,i,u,a,c=x.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},l=v(f,s),d=(e=c,t=n.clientX,r=n.clientY,o=s,i=f,u=l,a=n,{target:W(e),x:W(t),y:W(r),stop:o,prevent:i,kill:u,raw:W(a)});g(d)}}},S=function(n,e,t,r,o){var i=_(t,r);return n.dom().addEventListener(e,i,o),{unbind:l(E,n,e,i,o)}},E=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},C=W(!0),k=function(n,e,t){return S(n,e,C,t,!1)},T=function(n,e,t){return S(n,e,C,t,!0)},D=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}},M=D("string"),N=D("object"),F=D("array"),B=D("boolean"),R=D("function"),H=D("number"),I=Array.prototype.slice,P=void 0===(o=Array.prototype.indexOf)?function(n,e){return X(n,e)}:function(n,e){return o.call(n,e)},V=function(n,e){return-1<P(n,e)},j=function(n,e){return K(n,e).isSome()},L=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},U=function(n,e){for(var t=0,r=n.length;t<r;t++){e(n[t],t,n)}},z=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},G=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t,n)}(n,function(n){t=e(t,n)}),t},q=function(n,e,t){return U(n,function(n){t=e(t,n)}),t},Y=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return A.some(o)}return A.none()},K=function(n,e){for(var t=0,r=n.length;t<r;t++){if(e(n[t],t,n))return A.some(t)}return A.none()},X=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},Q=Array.prototype.push,$=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!F(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);Q.apply(e,n[t])}return e},J=function(n,e){var t=L(n,e);return $(t)},Z=function(n,e){for(var t=0,r=n.length;t<r;++t){if(!0!==e(n[t],t,n))return!1}return!0},nn=function(n){var e=I.call(n,0);return e.reverse(),e},en=function(n,e){return z(n,function(n){return!V(e,n)})},tn=function(n){return[n]},rn=function(n){return 0===n.length?A.none():A.some(n[0])},on=(R(Array.from)&&Array.from,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var r={};return U(e,function(n,e){r[n]=W(t[e])}),r}}),un=Object.keys,an=Object.hasOwnProperty,cn=function(n,e){for(var t=un(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},sn=function(n,r){return fn(n,function(n,e,t){return{k:e,v:r(n,e,t)}})},fn=function(r,o){var i={};return cn(r,function(n,e){var t=o(n,e,r);i[t.k]=t.v}),i},ln=function(n,t){var r=[];return cn(n,function(n,e){r.push(t(n,e))}),r},dn=function(n,e){return an.call(n,e)},mn=function(n){return n.slice(0).sort()},gn=function(e,n){if(!F(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");U(n,function(n){if(!M(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})},vn=function(o,i){var t,u=o.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return gn("required",o),gn("optional",i),t=mn(u),Y(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")}),function(e){var t=un(e);Z(o,function(n){return V(t,n)})||function(n,e){throw new Error("All required keys ("+mn(n).join(", ")+") were not specified. Specified keys were: "+mn(e).join(", ")+".")}(o,t);var n=z(t,function(n){return!V(u,n)});0<n.length&&function(n){throw new Error("Unsupported keys for object: "+mn(n).join(", "))}(n);var r={};return U(o,function(n){r[n]=W(e[n])}),U(i,function(n){r[n]=W(Object.prototype.hasOwnProperty.call(e,n)?A.some(e[n]):A.none())}),r}},pn=void 0!==b.window?b.window:Function("return this;")(),hn=function(n,e){return function(n,e){for(var t=null!=e?e:pn,r=0;r<n.length&&null!=t;++r)t=t[n[r]];return t}(n.split("."),e)},bn=function(n,e){var t=hn(n,e);if(null==t)throw new Error(n+" not available on this browser");return t},yn=function(){return bn("Node")},wn=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},On=function(n,e){return wn(n,e,yn().DOCUMENT_POSITION_CONTAINED_BY)},xn=function(t){var r,o=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o||(o=!0,r=t.apply(null,n)),r}},_n=function(){return Sn(0,0)},Sn=function(n,e){return{major:n,minor:e}},En={nu:Sn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?_n():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return Sn(r(1),r(2))}(n,t)},unknown:_n},Cn="Firefox",kn=function(n,e){return function(){return e===n}},Tn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:kn("Edge",e),isChrome:kn("Chrome",e),isIE:kn("IE",e),isOpera:kn("Opera",e),isFirefox:kn(Cn,e),isSafari:kn("Safari",e)}},Dn={unknown:function(){return Tn({current:void 0,version:En.unknown()})},nu:Tn,edge:W("Edge"),chrome:W("Chrome"),ie:W("IE"),opera:W("Opera"),firefox:W(Cn),safari:W("Safari")},Mn="Windows",Nn="Android",An="Solaris",Fn="FreeBSD",Bn=function(n,e){return function(){return e===n}},Rn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Bn(Mn,e),isiOS:Bn("iOS",e),isAndroid:Bn(Nn,e),isOSX:Bn("OSX",e),isLinux:Bn("Linux",e),isSolaris:Bn(An,e),isFreeBSD:Bn(Fn,e)}},Hn={unknown:function(){return Rn({current:void 0,version:En.unknown()})},nu:Rn,windows:W(Mn),ios:W("iOS"),android:W(Nn),linux:W("Linux"),osx:W("OSX"),solaris:W(An),freebsd:W(Fn)},In=function(n,e){var t=String(e).toLowerCase();return Y(n,function(n){return n.search(t)})},Pn=function(n,t){return In(n,t).map(function(n){var e=En.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Vn=function(n,t){return In(n,t).map(function(n){var e=En.detect(n.versionRegexes,t);return{current:n.name,version:e}})},jn=function(n,e){return-1!==n.indexOf(e)},Ln=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Un=function(e){return function(n){return jn(n,e)}},Wn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return jn(n,"edge/")&&jn(n,"chrome")&&jn(n,"safari")&&jn(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Ln],search:function(n){return jn(n,"chrome")&&!jn(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return jn(n,"msie")||jn(n,"trident")}},{name:"Opera",versionRegexes:[Ln,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Un("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Un("firefox")},{name:"Safari",versionRegexes:[Ln,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(jn(n,"safari")||jn(n,"mobile/"))&&jn(n,"applewebkit")}}],zn=[{name:"Windows",search:Un("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return jn(n,"iphone")||jn(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Un("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Un("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Un("linux"),versionRegexes:[]},{name:"Solaris",search:Un("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Un("freebsd"),versionRegexes:[]}],Gn={browsers:W(Wn),oses:W(zn)},qn=function(n){var e,t,r,o,i,u,a,c,s,f,l,d=Gn.browsers(),m=Gn.oses(),g=Pn(d,n).fold(Dn.unknown,Dn.nu),v=Vn(m,n).fold(Hn.unknown,Hn.nu);return{browser:g,os:v,deviceType:(t=g,r=n,o=(e=v).isiOS()&&!0===/ipad/i.test(r),i=e.isiOS()&&!o,u=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,c=o||u||a&&!0===/mobile/i.test(r),s=e.isiOS()||e.isAndroid(),f=s&&!c,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:W(o),isiPhone:W(i),isTablet:W(c),isPhone:W(f),isTouch:W(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:W(l)})}},Yn={detect:xn(function(){var n=b.navigator.userAgent;return qn(n)})},Kn=(b.Node.ATTRIBUTE_NODE,b.Node.CDATA_SECTION_NODE,b.Node.COMMENT_NODE,b.Node.DOCUMENT_NODE),Xn=(b.Node.DOCUMENT_TYPE_NODE,b.Node.DOCUMENT_FRAGMENT_NODE,b.Node.ELEMENT_NODE),Qn=b.Node.TEXT_NODE,$n=(b.Node.PROCESSING_INSTRUCTION_NODE,b.Node.ENTITY_REFERENCE_NODE,b.Node.ENTITY_NODE,b.Node.NOTATION_NODE,Xn),Jn=Kn,Zn=function(n,e){var t=n.dom();if(t.nodeType!==$n)return!1;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},ne=function(n){return n.nodeType!==$n&&n.nodeType!==Jn||0===n.childElementCount},ee=function(n,e){return n.dom()===e.dom()},te=(Yn.detect().browser.isIE(),function(n){return x.fromDom(n.dom().ownerDocument)}),re=function(n){var e=n.dom().ownerDocument.defaultView;return x.fromDom(e)},oe=function(n){var e=n.dom();return A.from(e.parentNode).map(x.fromDom)},ie=function(n){var e=n.dom();return L(e.childNodes,x.fromDom)},ue=function(n,e){var t=n.dom().childNodes;return A.from(t[e]).map(x.fromDom)},ae=function(n){return ue(n,0)},ce=(on("element","offset"),function(e,t){oe(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})}),se=function(e,t){ae(e).fold(function(){fe(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},fe=function(n,e){n.dom().appendChild(e.dom())},le=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return le(t())}}},de=function(n){var t=A.none(),e=[],r=function(n){o()?u(n):e.push(n)},o=function(){return t.isSome()},i=function(n){U(n,u)},u=function(e){t.each(function(n){b.setTimeout(function(){e(n)},0)})};return n(function(n){t=A.some(n),i(e),e=[]}),{get:r,map:function(t){return de(function(e){r(function(n){e(t(n))})})},isReady:o}},me={nu:de,pure:function(e){return de(function(n){n(e)})}},ge=function(e){var n=function(n){var r;e((r=n,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this;b.setTimeout(function(){r.apply(t,n)},0)}))},t=function(){return me.nu(n)};return{map:function(r){return ge(function(t){n(function(n){var e=r(n);t(e)})})},bind:function(t){return ge(function(e){n(function(n){t(n).get(e)})})},anonBind:function(t){return ge(function(e){n(function(n){t.get(e)})})},toLazy:t,toCached:function(){var e=null;return ge(function(n){null===e&&(e=t()),e.get(n)})},get:n}},ve={nu:ge,pure:function(e){return ge(function(n){n(e)})}},pe=function(n){return n.dom().nodeName.toLowerCase()},he=function(e){return function(n){return n.dom().nodeType===e}},be=he(Xn),ye=he(Qn),we=he(Kn),Oe=function(n,e,t){if(!(M(t)||B(t)||H(t)))throw b.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},xe=function(n,e,t){Oe(n.dom(),e,t)},_e=function(n,e){var t=n.dom();cn(e,function(n,e){Oe(t,e,n)})},Se=function(n,e){var t=n.dom().getAttribute(e);return null===t?void 0:t},Ee=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Ce=function(n,e){n.dom().removeAttribute(e)},ke=function(n){var e=ye(n)?n.dom().parentNode:n.dom();return null!=e&&e.ownerDocument.body.contains(e)},Te=(xn(function(){return Te(x.fromDom(b.document))}),function(n){var e=n.dom().body;if(null==e)throw new Error("Body is not available yet");return x.fromDom(e)}),De=(le(A.none()),"_tinycomments_sidebar"),Me=function(n){(0,tinymce[De])(n)};(i=w||(w={}))[i.Modern=0]="Modern",i[i.Silver=1]="Silver";var Ne=function(){return(Ne=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function Ae(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]])}return t}var Fe,Be,Re=function(t){return{is:function(n){return t===n},isValue:c,isError:a,getOr:W(t),getOrThunk:W(t),getOrDie:W(t),or:function(n){return Re(t)},orThunk:function(n){return Re(t)},fold:function(n,e){return e(t)},map:function(n){return Re(n(t))},mapError:function(n){return Re(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return A.some(t)}}},He=function(t){return{is:a,isValue:a,isError:c,getOr:s,getOrThunk:function(n){return n()},getOrDie:function(){return u(String(t))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return He(t)},mapError:function(n){return He(n(t))},each:y,bind:function(n){return He(t)},exists:a,forall:c,toOption:A.none}},Ie={value:Re,error:He,fromOption:function(n,e){return n.fold(function(){return He(e)},Re)}},Pe=function(i){return Ne({},i,{toCached:function(){return Pe(i.toCached())},bindFuture:function(e){return Pe(i.bind(function(n){return n.fold(function(n){return ve.pure(Ie.error(n))},function(n){return e(n)})}))},bindResult:function(e){return Pe(i.map(function(n){return n.bind(e)}))},mapResult:function(e){return Pe(i.map(function(n){return n.map(e)}))},mapError:function(e){return Pe(i.map(function(n){return n.mapError(e)}))},foldResult:function(e,t){return i.map(function(n){return n.fold(e,t)})},withTimeout:function(n,o){return Pe(ve.nu(function(e){var t=!1,r=b.setTimeout(function(){t=!0,e(Ie.error(o()))},n);i.get(function(n){t||(b.clearTimeout(r),e(n))})}))}})},Ve=function(n){return Pe(ve.nu(n))},je=function(n){return Pe(ve.pure(Ie.value(n)))},Le={nu:Ve,wrap:Pe,pure:je,value:je,error:function(n){return Pe(ve.pure(Ie.error(n)))},fromResult:function(n){return Pe(ve.pure(n))},fromFuture:function(n){return Pe(n.map(Ie.value))},fromPromise:function(n){return Ve(function(e){n.then(function(n){e(Ie.value(n))},function(n){e(Ie.error(n))})})}},Ue=function(n,e){var t=Se(n,e);return void 0===t||""===t?[]:t.split(" ")},We=function(n){return void 0!==n.dom().classList},ze=function(n,e){return o=e,i=Ue(t=n,r="class").concat([o]),xe(t,r,i.join(" ")),!0;var t,r,o,i},Ge=function(n,e){return o=e,0<(i=z(Ue(t=n,r="class"),function(n){return n!==o})).length?xe(t,r,i.join(" ")):Ce(t,r),!1;var t,r,o,i},qe=function(n,e){We(n)?n.dom().classList.add(e):ze(n,e)},Ye=function(n){0===(We(n)?n.dom().classList:Ue(n,"class")).length&&Ce(n,"class")},Ke=function(n,e){We(n)?n.dom().classList.remove(e):Ge(n,e);Ye(n)},Xe=function(n,e){return We(n)&&n.dom().classList.contains(e)},Qe=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),ne(o)?[]:L(o.querySelectorAll(t),x.fromDom);var t,r,o},$e=W("tox-comment--active"),Je=(W("data-mce-annotation-uid"),W("data-mce-annotation"),W("tinycomments"));function Ze(e,u,o,a){var t=function(n,e){o.notificationManager.open({text:n,type:"error"}),e&&console.error(n,e)},r=function(n,e){return{view:{type:"splash"},grabFocus:function(){return 1===n||e}}},i=function(n,i){u.set(n),u.get().fold(function(){return Le.pure({response:Fe.Change,update:r(i,a.hasFocus())})},function(n){return e.lookup({conversationUid:n}).foldResult(function(n){return Ie.value({response:Fe.Change,update:r(i,a.hasFocus())})},function(e){var n,t,r,o=u.get().forall(function(n){return n!==e.conversation.uid});return Ie.value(o?{response:Fe.NoChange}:{response:Fe.Change,update:(n=i,t=a.hasFocus(),r=e.conversation,{view:{type:"comments",conversation:r},grabFocus:function(){return t||V([1,3,4],n)}})})})}).get(function(n){return n.fold(function(n){t("An error occurred reading the conversation. See the Console for details.",n)},function(n){n.response===Fe.Change&&a.update(n.update)})})},c=function(n){var e="."+$e(),t=x.fromDom(n.getBody()),r=Qe(t,e);U(r,function(n){Ke(n,$e())})};return{refreshSidebar:i,refreshView:function(n){n.fold(function(){c(o),i(A.none(),0)},function(n){var e,t=n.uid,r=n.nodes;e=r,c(o),U(e,function(n){qe(n,$e())}),i(A.some(t),0)})},setReadonly:function(n){a.setReadonly(n)},showError:t}}(Be=Fe||(Fe={}))[Be.Change=0]="Change",Be[Be.NoChange=1]="NoChange";var nt,et,tt=function(u){if(!F(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],t={};return U(u,function(n,r){var e=un(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=n[o];if(void 0!==t[o])throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!F(i))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(n){var e=un(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!Z(a,function(n){return V(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,t)},log:function(n){b.console.log(n,{constructors:a,constructor:o,params:t})}}}}),t},rt=Object.prototype.hasOwnProperty,ot=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o=n[r];for(var i in o)rt.call(o,i)&&(t[i]=u(t[i],o[i]))}return t}},it=ot(function(n,e){return N(n)&&N(e)?it(n,e):e}),ut=ot(function(n,e){return e}),at=tt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ct=function(n){return at.defaultedThunk(W(n))},st=at.strict,ft=at.asOption,lt=at.defaultedThunk,dt=at.mergeWithThunk,mt=function(e){return function(n){return dn(n,e)?A.from(n[e]):A.none()}},gt=function(n,e){return mt(e)(n)},vt=function(n,e){var t={};return t[n]=e,t},pt=(tt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){return mt(n)}),ht=function(n,e){return t=n,r=e,function(n){return dn(n,t)?n[t]:r};var t,r},bt=function(n,e){return gt(n,e)},yt=function(n,e){return vt(n,e)},wt=function(n){return e={},U(n,function(n){e[n.key]=n.value}),e;var e},Ot=function(n,e){var t,r,o,i,u,a=(t=[],r=[],U(n,function(n){n.fold(function(n){t.push(n)},function(n){r.push(n)})}),{errors:t,values:r});return 0<a.errors.length?(u=a.errors,v(Ie.error,$)(u)):(i=e,0===(o=a.values).length?Ie.value(i):Ie.value(it(i,ut.apply(void 0,o))))},xt=function(n,e){return dn(t=n,r=e)&&void 0!==t[r]&&null!==t[r];var t,r};(et=nt||(nt={}))[et.Error=0]="Error",et[et.Value=1]="Value";var _t=function(n,e,t){return n.stype===nt.Error?e(n.serror):t(n.svalue)},St=function(n){return{stype:nt.Value,svalue:n}},Et=function(n){return{stype:nt.Error,serror:n}},Ct=function(n){return n.fold(Et,St)},kt=function(n){return _t(n,Ie.error,Ie.value)},Tt=St,Dt=function(n){var e=[],t=[];return U(n,function(n){_t(n,function(n){return t.push(n)},function(n){return e.push(n)})}),{values:e,errors:t}},Mt=Et,Nt=function(n,e){return n.stype===nt.Value?e(n.svalue):n},At=function(n,e){return n.stype===nt.Error?e(n.serror):n},Ft=function(n,e){return n.stype===nt.Value?{stype:nt.Value,svalue:e(n.svalue)}:n},Bt=function(n,e){return n.stype===nt.Error?{stype:nt.Error,serror:e(n.serror)}:n},Rt=function(n){return v(Mt,$)(n)},Ht=function(n,e){var t,r,o=Dt(n);return 0<o.errors.length?Rt(o.errors):(t=o.values,r=e,0<t.length?Tt(it(r,ut.apply(void 0,t))):Tt(r))},It=function(n){var e=Dt(n);return 0<e.errors.length?Rt(e.errors):Tt(e.values)},Pt=tt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),Vt=tt([{field:["name","presence","type"]},{state:["name"]}]),jt=function(){return bn("JSON")},Lt=function(n,e,t){return jt().stringify(n,e,t)},Ut=function(n){return N(n)&&100<un(n).length?" removed due to size":Lt(n,null,2)},Wt=function(n,e){return Mt([{path:n,getErrorInfo:e}])},zt=tt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Gt=function(t,r,o){return gt(r,o).fold(function(){return n=o,e=r,Wt(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+Ut(e)});var n,e},Tt)},qt=function(n,e,t){var r=gt(n,e).fold(function(){return t(n)},s);return Tt(r)},Yt=function(a,c,n,s){return n.fold(function(o,t,n,r){var i=function(n){var e=r.extract(a.concat([o]),s,n);return Ft(e,function(n){return vt(t,s(n))})},u=function(n){return n.fold(function(){var n=vt(t,s(A.none()));return Tt(n)},function(n){var e=r.extract(a.concat([o]),s,n);return Ft(e,function(n){return vt(t,s(A.some(n)))})})};return n.fold(function(){return Nt(Gt(a,c,o),i)},function(n){return Nt(qt(c,o,n),i)},function(){return Nt(Tt(gt(c,o)),u)},function(n){return Nt((t=n,r=gt(e=c,o).map(function(n){return!0===n?t(e):n}),Tt(r)),u);var e,t,r},function(n){var e=n(c),t=Ft(qt(c,o,W({})),function(n){return it(e,n)});return Nt(t,i)})},function(n,e){var t=e(c);return Tt(vt(n,s(t)))})},Kt=function(r){return{extract:function(t,n,e){return At(r(e,n),function(n){return e=n,Wt(t,function(){return e});var e})},toString:function(){return"val"},toDsl:function(){return Pt.itemOf(r)}}},Xt=function(n){var c=Qt(n),s=G(n,function(e,n){return n.fold(function(n){return it(e,yt(n,!0))},W(e))},{});return{extract:function(n,e,t){var r,o,i,u=B(t)?[]:(o=un(r=t),z(o,function(n){return xt(r,n)})),a=z(u,function(n){return!xt(s,n)});return 0===a.length?c.extract(n,e,t):(i=a,Wt(n,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:c.toString,toDsl:c.toDsl}},Qt=function(a){return{extract:function(n,e,t){return r=n,o=t,i=e,u=L(a,function(n){return Yt(r,o,n,i)}),Ht(u,{});var r,o,i,u},toString:function(){return"obj{\n"+L(a,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return Pt.objOf(L(a,function(n){return n.fold(function(n,e,t,r){return Vt.field(n,t,r)},function(n,e){return Vt.state(n)})}))}}},$t=function(t,i){var u=function(n,e){return(o=Kt(t),{extract:function(t,r,n){var e=L(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return It(e)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return Pt.arrOf(o)}}).extract(n,s,e);var o};return{extract:function(t,r,o){var n=un(o),e=u(t,n);return Nt(e,function(n){var e=L(n,function(n){return zt.field(n,n,st(),i)});return Qt(e).extract(t,r,o)})},toString:function(){return"setOf("+i.toString()+")"},toDsl:function(){return Pt.setOf(t,i)}}},Jt=W(Kt(Tt)),Zt=zt.state,nr=zt.field,er=function(t,e,r,o,i){return bt(o,i).fold(function(){return n=o,e=i,Wt(t,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+Ut(n)});var n,e},function(n){return Qt(n).extract(t.concat(["branch: "+i]),e,r)})},tr=function(o,i){return{extract:function(e,t,r){return bt(r,o).fold(function(){return n=o,Wt(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return er(e,t,r,i,n)})},toString:function(){return"chooseOn("+o+"). Possible values: "+un(i)},toDsl:function(){return Pt.choiceOf(o,i)}}},rr=Kt(Tt),or=function(e){return Kt(function(n){return e(n).fold(Mt,Tt)})},ir=function(e,n){return $t(function(n){return Ct(e(n))},n)},ur=function(n,e,t){return kt((r=n,o=s,i=t,u=e.extract([r],o,i),Bt(u,function(n){return{input:i,errors:n}})));var r,o,i,u},ar=function(n){return n.fold(function(n){throw new Error(sr(n))},s)},cr=function(n,e,t){return ar(ur(n,e,t))},sr=function(n){return"Errors: \n"+(e=n.errors,t=10<e.length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,L(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+Ut(n.input);var e,t},fr=function(n,e){return tr(n,e)},lr=W(rr),dr=function(t,r){return Kt(function(n){var e=typeof n;return t(n)?Tt(n):Mt("Expected type: "+r+" but got: "+e)})},mr=dr(B,"boolean"),gr=dr(R,"function"),vr=function(n){return nr(n,n,st(),Jt())},pr=function(n,e){return nr(n,n,st(),e)},hr=function(n,e){return nr(n,n,st(),Qt(e))},br=function(n){return nr(n,n,ft(),Jt())},yr=function(n,e){return nr(n,n,ft(),e)},wr=function(n,e){return yr(n,Qt(e))},Or=function(n,e){return yr(n,Xt(e))},xr=function(n,e){return nr(n,n,ct(e),Jt())},_r=function(n,e,t){return nr(n,n,ct(e),t)},Sr=function(n,e){return Zt(n,e)},Er={init:function(){return Cr({readState:function(){return"No State required"}})}},Cr=function(n){return n},kr=function(n,e){return ee(n.element(),e.event().target())},Tr=function(n){if(!xt(n,"can")&&!xt(n,"abort")&&!xt(n,"run"))throw new Error("EventHandler defined by: "+Lt(n,null,2)+" does not have can, abort, or run!");return cr("Extracting event.handler",Xt([xr("can",W(!0)),xr("abort",W(!1)),xr("run",y)]),n)},Dr=function(t){var e,r,o,i,n=(e=t,r=function(n){return n.can},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return q(e,function(n,e){return n&&r(e).apply(void 0,t)},!0)}),u=(o=t,i=function(n){return n.abort},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return q(o,function(n,e){return n||i(e).apply(void 0,t)},!1)});return Tr({can:n,abort:u,run:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];U(t,function(n){n.run.apply(void 0,e)})}})},Mr=W("touchstart"),Nr=W("touchmove"),Ar=W("touchend"),Fr=W("mousedown"),Br=W("mouseover"),Rr=W("keydown"),Hr=W("keyup"),Ir=W("input"),Pr=W("click"),Vr=W("transitionend"),jr={tap:W("alloy.tap")},Lr=W("alloy.focus"),Ur=W("alloy.blur.post"),Wr=W("alloy.paste.post"),zr=W("alloy.receive"),Gr=W("alloy.execute"),qr=W("alloy.focus.item"),Yr=jr.tap,Kr=Yn.detect().deviceType.isTouch()?jr.tap:Pr,Xr=W("alloy.longpress"),Qr=W("alloy.sandbox.close"),$r=W("alloy.system.init"),Jr=W("alloy.system.attached"),Zr=W("alloy.system.detached"),no=W("alloy.system.dismissRequested"),eo=W("alloy.focusmanager.shifted"),to=W("alloy.highlight"),ro=W("alloy.dehighlight"),oo=function(n,e){co(n,n.element(),e,{})},io=function(n,e,t){co(n,n.element(),e,t)},uo=function(n){oo(n,Gr())},ao=function(n,e,t){co(n,e,t,{})},co=function(n,e,t,r){var o=Ne({target:e},r);n.getSystem().triggerEvent(t,e,sn(o,W))};function so(n,e,t,r,o){return n(t,r)?A.some(t):R(o)&&o(t)?A.none():e(t,r,o)}var fo,lo,mo,go=function(n,e,t){for(var r=n.dom(),o=R(t)?t:W(!1);r.parentNode;){r=r.parentNode;var i=x.fromDom(r);if(e(i))return A.some(i);if(o(i))break}return A.none()},vo=function(n,e,t){return so(function(n){return e(n)},go,n,e,t)},po=function(n,r){var o=function(n){for(var e=0;e<n.childNodes.length;e++){if(r(x.fromDom(n.childNodes[e])))return A.some(x.fromDom(n.childNodes[e]));var t=o(n.childNodes[e]);if(t.isSome())return t}return A.none()};return o(n.dom())},ho=function(n,e,t){return vo(n,function(n){return e(n).isSome()},t).bind(e)},bo=function(n){return wt(n)},yo=function(n,e){return{key:n,value:Tr({run:e})}},wo=function(n){return function(t){return{key:n,value:Tr({run:function(n,e){kr(n,e)&&t(n,e)}})}}},Oo=function(n){return yo(n,function(n,e){e.cut()})},xo=wo(Jr()),_o=wo(Zr()),So=wo($r()),Eo=(fo=Gr(),function(n){return yo(fo,n)}),Co=function(n){return L(n,function(n){return r=e="/*",o=(t=n).length-e.length,""!==r&&(t.length<r.length||t.substr(o,o+r.length)!==r)?n:n.substring(0,n.length-"/*".length);var e,t,r,o})},ko=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:Co(i)}},n},To=function(n){return{classes:void 0!==n.classes?n.classes:[],attributes:void 0!==n.attributes?n.attributes:{},styles:void 0!==n.styles?n.styles:{}}},Do=function(t,r,o){return So(function(n,e){o(n,t,r)})},Mo=function(o,i,u){var n,e,t,r,a,c;return n=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=[t].concat(n);return t.config({name:W(o)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+o+". Using API: "+u)},function(n){var e=Array.prototype.slice.call(r,1);return i.apply(void 0,[t,n.config,n.state].concat(e))})},e=u,t=i.toString(),r=t.indexOf(")")+1,a=t.indexOf("("),c=t.substring(a+1,r-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:e,parameters:Co(c.slice(0,1).concat(c.slice(3)))}},n},No=function(n){return{key:n,value:void 0}},Ao=function(t,n,r,o,e,i,u){var a=function(n){return xt(n,r)?n[r]():A.none()},c=sn(e,function(n,e){return Mo(r,n,e)}),s=sn(i,function(n,e){return ko(n,e)}),f=Ne({},s,c,{revoke:l(No,r),config:function(n){var e=cr(r+"-config",t,n);return{key:r,value:{config:e,me:f,configAsRaw:xn(function(){return cr(r+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return a(n).bind(function(e){return bt(o,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(To({}))},name:function(){return r},handlers:function(n){return a(n).map(function(n){return ht("events",function(n,e){return{}})(o)(n.config,n.state)}).getOr({})}});return f},Fo=function(n){return wt(n)},Bo=Xt([vr("fields"),vr("name"),xr("active",{}),xr("apis",{}),xr("state",Er),xr("extra",{})]),Ro=function(n){var e,t,r,o,i,u,a,c,s=cr("Creating behaviour: "+n.name,Bo,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,a=Xt(e),c=wr(t,[Or("config",e)]),Ao(a,c,t,r,o,i,u)},Ho=Xt([vr("branchKey"),vr("branches"),vr("name"),xr("active",{}),xr("apis",{}),xr("state",Er),xr("extra",{})]),Io=W(void 0),Po=function(n,e){var t,r;return{key:n,value:{config:{},me:(t=n,r=bo(e),Ro({fields:[vr("enabled")],name:t,active:{events:W(r)}})),configAsRaw:W({}),initialConfig:{},state:Er}}},Vo=function(n){n.dom().focus()},jo=function(n){var e=void 0!==n?n.dom():b.document;return A.from(e.activeElement).map(x.fromDom)},Lo=function(e){return jo(te(e)).filter(function(n){return e.dom().contains(n.dom())})},Uo=function(e,n){U(n,function(n){fe(e,n)})},Wo=function(n){n.dom().textContent="",U(ie(n),function(n){zo(n)})},zo=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Go=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},qo=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return A.none()},Yo=function(n){return n.dom().innerHTML},Ko=function(n,e){var t,r,o=te(n).dom(),i=x.fromDom(o.createDocumentFragment()),u=(t=e,(r=(o||b.document).createElement("div")).innerHTML=t,ie(x.fromDom(r)));Uo(i,u),Wo(n),fe(n,i)},Xo=function(n){return e=n,t=!1,x.fromDom(e.dom().cloneNode(t));var e,t},Qo=function(n){var e,t,r,o=Xo(n);return e=o,t=x.fromTag("div"),r=x.fromDom(e.dom().cloneNode(!0)),fe(t,r),Yo(t)},$o=function(n){return Qo(n)},Jo="unknown";(mo=lo||(lo={}))[mo.STOP=0]="STOP",mo[mo.NORMAL=1]="NORMAL",mo[mo.LOGGING=2]="LOGGING";var Zo=le({}),ni=function(e,n,t){var r,o,i,u;switch(bt(Zo.get(),e).orThunk(function(){var n=un(Zo.get());return qo(n,function(n){return-1<e.indexOf(n)?A.some(Zo.get()[n]):A.none()})}).getOr(lo.NORMAL)){case lo.NORMAL:return t(ri());case lo.LOGGING:var a=(r=e,o=n,i=[],u=(new Date).getTime(),{logEventCut:function(n,e,t){i.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){i.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){i.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){i.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){i.push({outcome:"response",purpose:t,target:e})},write:function(){var n=(new Date).getTime();V(["mousemove","mouseover","mouseout",$r()],r)||b.console.log(r,{event:r,time:n-u,target:o.dom(),sequence:L(i,function(n){return V(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+$o(n.target)+")":n.outcome})})}}),c=t(a);return a.write(),c;case lo.STOP:return!0}},ei=["alloy/data/Fields","alloy/debugging/Debugging"],ti=function(n,e,t){return ni(n,e,t)},ri=W({logEventCut:y,logEventStopped:y,logNoParent:y,logEventNoHandlers:y,logEventResponse:y,write:y}),oi=function(n,e){return t=l.apply(void 0,[n.handler].concat(e)),r=n.purpose(),{cHandler:t,purpose:W(r)};var t,r},ii=function(n){return n.cHandler},ui=function(n,e,t){return go(n,function(n){return Zn(n,e)},t)},ai=function(n,e){return t=e,o=void 0===(r=n)?b.document:r.dom(),ne(o)?A.none():A.from(o.querySelector(t)).map(x.fromDom);var t,r,o},ci=function(n,e,t){return so(Zn,ui,n,e,t)};var si,fi=function(n){var e=n.raw();return void 0===e.touches||1!==e.touches.length?A.none():A.some(e.touches[0])},li=function(t){var r,o,i,u=le(A.none()),a=(r=function(n){u.set(A.none()),t.triggerEvent(Xr(),n)},o=400,i=null,{cancel:function(){null!==i&&(b.clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i=b.setTimeout(function(){r.apply(null,n),i=null},o)}}),c=wt([{key:Mr(),value:function(t){return fi(t).each(function(n){a.cancel();var e={x:W(n.clientX),y:W(n.clientY),target:t.target};a.schedule(t),u.set(A.some(e))}),A.none()}},{key:Nr(),value:function(n){return a.cancel(),fi(n).each(function(i){u.get().each(function(n){var e,t,r,o;e=i,t=n,r=Math.abs(e.clientX-t.x()),o=Math.abs(e.clientY-t.y()),(5<r||5<o)&&u.set(A.none())})}),A.none()}},{key:Ar(),value:function(e){a.cancel();return u.get().filter(function(n){return ee(n.target(),e.target())}).map(function(n){return t.triggerEvent(Yr(),e)})}}]);return{fireIfReady:function(e,n){return bt(c,n).bind(function(n){return n(e)})}}},di=function(n){var e,t;return 8===n.raw().which&&!V(["input","textarea"],pe(n.target()))&&(e=n.target(),!ci(e,'[contenteditable="true"]',t).isSome())},mi=Yn.detect().browser.isFirefox(),gi=Xt([(si="triggerEvent",pr(si,gr)),xr("stopBackspace",!0)]),vi=function(e,n){var t,r,o,i,u=cr("Getting GUI events settings",gi,n),a=Yn.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=li(u),s=L(a.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop","keyup"]),function(n){return k(e,n,function(e){c.fireIfReady(e,n).each(function(n){n&&e.kill()}),u.triggerEvent(n,e)&&e.kill()})}),f=le(A.none()),l=k(e,"paste",function(e){c.fireIfReady(e,"paste").each(function(n){n&&e.kill()}),u.triggerEvent("paste",e)&&e.kill(),f.set(A.some(b.setTimeout(function(){u.triggerEvent(Wr(),e)},0)))}),d=k(e,"keydown",function(n){u.triggerEvent("keydown",n)?n.kill():!0===u.stopBackspace&&di(n)&&n.prevent()}),m=(t=e,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},mi?T(t,"focus",r):k(t,"focusin",r)),g=le(A.none()),v=(o=e,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),g.set(A.some(b.setTimeout(function(){u.triggerEvent(Ur(),n)},0)))},mi?T(o,"blur",i):k(o,"focusout",i));return{unbind:function(){U(s,function(n){n.unbind()}),d.unbind(),m.unbind(),v.unbind(),l.unbind(),f.get().each(b.clearTimeout),g.get().each(b.clearTimeout)}}},pi=function(n,e){var t=bt(n,"target").map(function(n){return n()}).getOr(e);return le(t)},hi=tt([{stopped:[]},{resume:["element"]},{complete:[]}]),bi=function(n,r,e,t,o,i){var u,a,c,s,f=n(r,t),l=(u=e,a=o,c=le(!1),s=le(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:W(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(r,t),hi.complete()},function(e){var t=e.descHandler();return ii(t)(l),l.isStopped()?(i.logEventStopped(r,e.element(),t.purpose()),hi.stopped()):l.isCut()?(i.logEventCut(r,e.element(),t.purpose()),hi.complete()):oe(e.element()).fold(function(){return i.logNoParent(r,e.element(),t.purpose()),hi.complete()},function(n){return i.logEventResponse(r,e.element(),t.purpose()),hi.resume(n)})})},yi=function(e,t,r,n,o,i){return bi(e,t,r,n,o,i).fold(function(){return!0},function(n){return yi(e,t,r,n,o,i)},function(){return!1})},wi=function(n,e,t){var r,o,i=(r=e,o=le(!1),{stop:function(){o.set(!0)},cut:y,isStopped:o.get,isCut:W(!1),event:W(r),setSource:u("Cannot set source of a broadcasted event"),getSource:u("Cannot get source of a broadcasted event")});return U(n,function(n){var e=n.descHandler();ii(e)(i)}),i.isStopped()},Oi=function(n,e,t,r,o){var i=pi(t,r);return yi(n,e,t,r,i,o)},xi=0,_i=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++xi+String(e)},Si=W("alloy-id-"),Ei=W("data-alloy-id"),Ci=Si(),ki=Ei(),Ti=function(n,e){Object.defineProperty(n.dom(),ki,{value:e,writable:!0})},Di=function(n){var e=be(n)?n.dom()[ki]:null;return A.from(e)},Mi=function(n){return _i(n)},Ni=on("element","descHandler"),Ai=function(n,e){return{id:W(n),descHandler:W(e)}};function Fi(){var i={};return{registerId:function(r,o,n){cn(n,function(n,e){var t=void 0!==i[e]?i[e]:{};t[o]=oi(n,r),i[e]=t})},unregisterId:function(t){cn(i,function(n,e){n.hasOwnProperty(t)&&delete n[t]})},filterByType:function(n){return bt(i,n).map(function(n){return ln(n,function(n,e){return Ai(e,n)})}).getOr([])},find:function(n,e,t){var o=pt(e)(i);return ho(t,function(n){return t=o,Di(r=n).fold(function(){return A.none()},function(n){var e=pt(n);return t.bind(e).map(function(n){return Ni(r,n)})});var t,r},n)}}}function Bi(){var r=Fi(),o={},i=function(r){var n=r.element();return Di(n).fold(function(){return n="uid-",e=r.element(),t=_i(Ci+n),Ti(e,t),t;var n,e,t},function(n){return n})},u=function(n){Di(n.element()).each(function(n){delete o[n],r.unregisterId(n)})};return{find:function(n,e,t){return r.find(n,e,t)},filter:function(n){return r.filterByType(n)},register:function(n){var e=i(n);xt(o,e)&&function(n,e){var t=o[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+$o(t.element())+"\nCannot use it for: "+$o(n.element())+"\nThe conflicting element is"+(ke(t.element())?" ":" not ")+"already in the DOM");u(n)}(n,e);var t=[n];r.registerId(t,e,n.events()),o[e]=n},unregister:u,getById:function(n){return pt(n)(o)}}}var Ri,Hi,Ii=bo([(Ri=Lr(),Hi=function(n,e){var t,r,o=e.event().originator(),i=e.event().target();return r=i,!(ee(t=o,n.element())&&!ee(t,r))||(b.console.warn(Lr()+" did not get interpreted by the desired target. \nOriginator: "+$o(o)+"\nTarget: "+$o(i)+"\nCheck the "+Lr()+" event handlers"),!1)},{key:Ri,value:Tr({can:Hi})})]),Pi=Object.freeze({events:Ii}),Vi=s,ji=function(e){var n=function(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+$o(e().element())+" is not in context.")}};return{debugInfo:W("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),broadcastEvent:n("broadcastEvent"),isConnected:W(!1)}},Li=ji(),Ui=_i("alloy-premade"),Wi=function(n){return yt(Ui,n)},zi=function(r){return n=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return r.apply(void 0,[n.getApis()].concat([n].concat(e)))},e=r.toString(),t=e.indexOf(")")+1,o=e.indexOf("("),i=e.substring(o+1,t-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Co(i.slice(1))}},n;var n,e,t,o,i},Gi=function(n,o){var i={};return cn(n,function(n,r){cn(n,function(n,e){var t=ht(e,[])(i);i[e]=t.concat([o(r,n)])})}),i},qi=function(n,e){return{name:W(n),handler:W(e)}},Yi=function(n,e,t){var r,o,i=Ne({},t,(r=n,o={},U(e,function(n){o[n.name()]=n.handlers(r)}),o));return Gi(i,qi)},Ki=function(n){var e,i=R(e=n)?{can:W(!0),abort:W(!1),run:e}:e;return function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=[n,e].concat(t);i.abort.apply(void 0,o)?e.stop():i.can.apply(void 0,o)&&i.run.apply(void 0,o)}},Xi=function(n,e,t){var r,o,i=e[t];return i?function(u,a,n,c){var e=n.slice(0);try{var t=e.sort(function(n,e){var t=n[a](),r=e[a](),o=c.indexOf(t),i=c.indexOf(r);if(-1===o)throw new Error("The ordering for "+u+" does not have an entry for "+t+".\nOrder specified: "+Lt(c,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+r+".\nOrder specified: "+Lt(c,null,2));return o<i?-1:i<o?1:0});return Ie.value(t)}catch(n){return Ie.error([n])}}("Event: "+t,"name",n,i).map(function(n){var e=L(n,function(n){return n.handler()});return Dr(e)}):(r=t,o=n,Ie.error(["The event ("+r+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+Lt(L(o,function(n){return n.name()}),null,2)]))},Qi=function(n,i){var e=ln(n,function(r,o){return(1===r.length?Ie.value(r[0].handler()):Xi(r,i,o)).map(function(n){var e=Ki(n),t=1<r.length?z(i,function(e){return V(r,function(n){return n.name()===e})}).join(" > "):r[0].name();return yt(o,{handler:e,purpose:W(t)})})});return Ot(e,{})},$i=function(n){return ur("custom.definition",Qt([nr("dom","dom",st(),Qt([vr("tag"),xr("styles",{}),xr("classes",[]),xr("attributes",{}),br("value"),br("innerHtml")])),vr("components"),vr("uid"),xr("events",{}),xr("apis",{}),nr("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling","typeaheadevents"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing","item-events","tooltipping"],mousedown:["focusing","alloy.base.behaviour","item-type-events"],mouseover:["item-type-events","tooltipping"]},at.mergeWithThunk(W(e))),lr()),br("domModification")]),n);var e},Ji=function(e,n){U(n,function(n){qe(e,n)})},Zi=function(e,n){U(n,function(n){Ke(e,n)})},nu=function(n){return void 0!==n.style&&R(n.style.getPropertyValue)},eu=function(n,e,t){if(!M(t))throw b.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);nu(n)&&n.style.setProperty(e,t)},tu=function(n,e){nu(n)&&n.style.removeProperty(e)},ru=function(n,e,t){var r=n.dom();eu(r,e,t)},ou=function(n,e){var t=n.dom();cn(e,function(n,e){eu(t,e,n)})},iu=function(n,e){var t=n.dom(),r=b.window.getComputedStyle(t).getPropertyValue(e),o=""!==r||ke(n)?r:uu(t,e);return null===o?void 0:o},uu=function(n,e){return nu(n)?n.style.getPropertyValue(e):""},au=function(n,e){var t=n.dom(),r=uu(t,e);return A.from(r).filter(function(n){return 0<n.length})},cu=function(n,e){var t=n.dom();tu(t,e),Ee(n,"style")&&""===Se(n,"style").replace(/^\s+|\s+$/g,"")&&Ce(n,"style")},su=function(n){return n.dom().value},fu=function(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e},lu=function(n,e){return t=n,o=L(r=e,function(n){return wr(n.name(),[vr("config"),xr("state",Er)])}),i=ur("component.behaviours",Qt(o),t.behaviours).fold(function(n){throw new Error(sr(n)+"\nComplete spec:\n"+Lt(t,null,2))},function(n){return n}),{list:r,data:sn(i,function(n){var e=n.map(function(n){return{config:n.config,state:n.state.init(n.config)}});return function(){return e}})};var t,r,o,i},du=function(n){var e,t,r,o=(e=n,t=ht("behaviours",{})(e),r=z(un(t),function(n){return void 0!==t[n]}),L(r,function(n){return t[n].me}));return lu(n,o)},mu=function(n,e,t){var r,o,i,u=Ne({},(r=n).dom,{uid:r.uid,domChildren:L(r.components,function(n){return n.element()})}),a=n.domModification.fold(function(){return To({})},To),c={"alloy.base.modification":a},s=0<e.length?function(e,n,t,r){var o=Ne({},n);U(t,function(n){o[n.name()]=n.exhibit(e,r)});var i=Gi(o,function(n,e){return{name:n,modification:e}}),u=function(n){return G(n,function(n,e){return Ne({},e.modification,n)},{})},a=G(i.classes,function(n,e){return e.modification.concat(n)},[]),c=u(i.attributes),s=u(i.styles);return To({classes:a,attributes:c,styles:s})}(t,c,e,u):a;return i=s,Ne({},o=u,{attributes:Ne({},o.attributes,i.attributes),styles:Ne({},o.styles,i.styles),classes:o.classes.concat(i.classes)})},gu=function(n,e,t){var r,o,i,u,a,c,s={"alloy.base.behaviour":(r=n,r.events)};return(o=t,i=n.eventOrder,u=e,a=s,c=Yi(o,u,a),Qi(c,i)).getOrDie()},vu=function(t){var n=function(){return f},r=le(Li),e=ar($i(t)),o=du(t),i=o.list,u=o.data,a=function(n){var e=x.fromTag(n.tag);_e(e,n.attributes),Ji(e,n.classes),ou(e,n.styles),n.innerHtml.each(function(n){return Ko(e,n)});var t=n.domChildren;return Uo(e,t),n.value.each(function(n){fu(e,n)}),n.uid,Ti(e,n.uid),e}(mu(e,i,u)),c=gu(e,i,u),s=le(e.components),f={getSystem:r.get,config:function(n){var e=u;return(R(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+Lt(t,null,2))})()},hasConfigured:function(n){return R(u[n.name()])},spec:W(t),readState:function(n){return u[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},getApis:function(){return e.apis},connect:function(n){r.set(n)},disconnect:function(){r.set(ji(n))},element:W(a),syncComponents:function(){var n=ie(a),e=J(n,function(n){return r.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});s.set(e)},components:s.get,events:W(c)};return f},pu=function(n){var e,t,r=Vi(n),o=r.events,i=Ae(r,["events"]),u=(e=i,t=ht("components",[])(e),L(t,yu)),a=Ne({},i,{events:Ne({},Pi,o),components:u});return Ie.value(vu(a))},hu=function(n){var e=cr("external.component",Xt([vr("element"),br("uid")]),n),t=le(ji());e.uid.each(function(n){Ti(e.element,n)});var r={getSystem:t.get,config:A.none,hasConfigured:W(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(ji(function(){return r}))},getApis:function(){return{}},element:W(e.element),spec:W(n),readState:W("No state"),syncComponents:y,components:W([]),events:W({})};return Wi(r)},bu=Mi,yu=function(e){return(n=e,bt(n,Ui)).fold(function(){var n=e.hasOwnProperty("uid")?e:Ne({uid:bu("")},e);return pu(n).getOrDie()},function(n){return n});var n},wu=Wi,Ou=function(r,n){return e=r,t={},o=L(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+r,nr(e,e,ft(),Kt(function(n){return Mt("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([Sr("dump",s)]),_r(e,t,Qt(o));var e,t,o},xu=function(n){return n.dump},_u=function(n,e){return Ne({},n.dump,Fo(e))},Su=Ou,Eu=_u,Cu=W([vr("menu"),vr("selectedMenu")]),ku=W([vr("item"),vr("selectedItem")]),Tu=(W(Qt(ku().concat(Cu()))),W(Qt(ku()))),Du=hr("initSize",[vr("numColumns"),vr("numRows")]),Mu=function(){return hr("markers",[vr("backgroundMenu")].concat(Cu()).concat(ku()))},Nu=function(n,e,t){!function(){var n=new Error;if(void 0===n.stack)return;var e=n.stack.split("\n");Y(e,function(e){return 0<e.indexOf("alloy")&&!j(ei,function(n){return-1<e.indexOf(n)})}).getOr(Jo)}();return nr(e,e,t,or(function(t){return Ie.value(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(void 0,n)})}))},Au=function(n){return Nu(0,n,ct(y))},Fu=function(n){return Nu(0,n,ct(A.none))},Bu=function(n){return Nu(0,n,st())},Ru=function(n){return Nu(0,n,st())},Hu=function(n,e){return Sr(n,W(e))},Iu=function(n){return Sr(n,s)},Pu=W(Du),Vu="placeholder",ju=tt([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Lu=function(n,e,t,r){return t.uiType===Vu?(i=t,u=r,(o=n).exists(function(n){return n!==i.owner})?ju.single(!0,W(i)):bt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+un(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+Lt(i,null,2))},function(n){return n.replace()})):ju.single(!1,W(t));var o,i,u},Uu=function(i,u,a,c){return Lu(i,0,a,c).fold(function(n,e){var t=e(u,a.config,a.validated),r=bt(t,"components").getOr([]),o=J(r,function(n){return Uu(i,u,n,c)});return[Ne({},t,{components:o})]},function(n,e){var t=e(u,a.config,a.validated);return a.validated.preprocess.getOr(s)(t)})},Wu=function(e,t,n,r){var o,i,u,a=sn(r,function(n,e){return r=n,o=!1,{name:W(t=e),required:function(){return r.fold(function(n,e){return n},function(n,e){return n})},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+t);return o=!0,r}};var t,r,o}),c=(o=e,i=t,u=a,J(n,function(n){return Uu(o,i,n,u)}));return cn(a,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+Lt(t.components,null,2))}),c},zu=ju.single,Gu=ju.multiple,qu=W(Vu),Yu=tt([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Ku=xr("factory",{sketch:s}),Xu=xr("schema",[]),Qu=vr("name"),$u=nr("pname","pname",lt(function(n){return"<alloy."+_i(n.name)+">"}),lr()),Ju=Sr("schema",function(){return[br("preprocess")]}),Zu=xr("defaults",W({})),na=xr("overrides",W({})),ea=Qt([Ku,Xu,Qu,$u,Zu,na]),ta=Qt([Ku,Xu,Qu,Zu,na]),ra=Qt([Ku,Xu,Qu,$u,Zu,na]),oa=Qt([Ku,Ju,Qu,vr("unit"),$u,Zu,na]),ia=function(n){var e=function(n){return n.name};return n.fold(e,e,e,e)},ua=function(t,r){return function(n){var e=cr("Converting part type",r,n);return t(e)}},aa=ua(Yu.required,ea),ca=ua(Yu.external,ta),sa=ua(Yu.optional,ra),fa=ua(Yu.group,oa),la=W("entirety"),da=function(n,e,t,r){return it(e.defaults(n,t,r),t,{uid:n.partUids[e.name]},e.overrides(n,t,r))},ma=function(o,n){var i={};return U(n,function(n){var e;(e=n,e.fold(A.some,A.none,A.some,A.some)).each(function(t){var r=ga(o,t.pname);i[t.name]=function(n){var e=cr("Part: "+t.name+" in "+o,Qt(t.schema),n);return Ne({},r,{config:n,validated:e})}})}),i},ga=function(n,e){return{uiType:qu(),owner:n,name:e}},va=function(n,e,t){return r=e,i={},o={},U(t,function(n){n.fold(function(r){i[r.pname]=zu(!0,function(n,e,t){return r.factory.sketch(da(n,r,e,t))})},function(n){var e=r.parts[n.name];o[n.name]=W(n.factory.sketch(da(r,n,e[la()]),e))},function(r){i[r.pname]=zu(!1,function(n,e,t){return r.factory.sketch(da(n,r,e,t))})},function(o){i[o.pname]=Gu(!0,function(e,n,t){var r=e[o.name];return L(r,function(n){return o.factory.sketch(it(o.defaults(e,n,t),n,o.overrides(e,n)))})})})}),{internals:W(i),externals:W(o)};var r,i,o},pa=function(n,e,t){return Wu(A.some(n),e,e.components,t)},ha=function(e,n){var t=L(n,ia);return wt(L(t,function(n){return{key:n,value:e+"-"+n}}))},ba=function(e){return nr("partUids","partUids",dt(function(n){return ha(n.uid,e)}),lr())},ya=function(n,e,t,r,o){var i,u,a=(u=o,(0<(i=r).length?[hr("parts",i)]:[]).concat([vr("uid"),xr("dom",{}),xr("components",[]),Iu("originalSpec"),xr("debug.sketcher",{})]).concat(u));return cr(n+" [SpecSchema]",Xt(a.concat(e)),t)},wa=function(n,e,t,r,o){var i=Oa(o),u=J(t,function(n){return n.fold(A.none,A.some,A.none,A.none).map(function(n){return hr(n.name,n.schema.concat([Iu(la())]))}).toArray()}),a=ba(t),c=ya(n,e,i,u,[a]),s=va(0,c,t);return r(c,pa(n,c,s.internals()),i,s.externals())},Oa=function(n){return n.hasOwnProperty("uid")?n:Ne({},n,{uid:Mi("uid")})};var xa=Xt([vr("name"),vr("factory"),vr("configFields"),xr("apis",{}),xr("extraApis",{})]),_a=Xt([vr("name"),vr("factory"),vr("configFields"),vr("partFields"),xr("apis",{}),xr("extraApis",{})]),Sa=function(n){var i=cr("Sketcher for "+n.name,xa,n),e=sn(i.apis,zi),t=sn(i.extraApis,function(n,e){return ko(n,e)});return Ne({name:W(i.name),partFields:W([]),configFields:W(i.configFields),sketch:function(n){return e=i.name,t=i.configFields,r=i.factory,o=Oa(n),r(ya(e,t,o,[],[]),o);var e,t,r,o}},e,t)},Ea=function(n){var e=cr("Sketcher for "+n.name,_a,n),t=ma(e.name,e.partFields),r=sn(e.apis,zi),o=sn(e.extraApis,function(n,e){return ko(n,e)});return Ne({name:W(e.name),partFields:W(e.partFields),configFields:W(e.configFields),sketch:function(n){return wa(e.name,e.configFields,e.partFields,e.factory,n)},parts:W(t)},r,o)},Ca=(Sa({name:"Container",factory:function(n){var e=n.dom,t=e.attributes,r=Ae(e,["attributes"]);return{uid:n.uid,dom:Ne({tag:"div",attributes:Ne({role:"presentation"},t)},r),components:n.components,behaviours:xu(n.containerBehaviours),events:n.events,domModification:n.domModification,eventOrder:n.eventOrder}},configFields:[xr("components",[]),Ou("containerBehaviours",[]),xr("events",{}),xr("domModification",{}),xr("eventOrder",{})]}),function(n){oo(n,Zr());var e=n.components();U(e,Ca)}),ka=function(n){var e=n.components();U(e,ka),oo(n,Jr())},Ta=function(n,e){Da(n,e,fe)},Da=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),ke(n.element())&&ka(e),n.syncComponents()},Ma=function(n){Ca(n),zo(n.element()),n.getSystem().removeFromWorld(n)},Na=function(e){var n=oe(e.element()).bind(function(n){return e.getSystem().getByDom(n).fold(A.none,A.some)});Ma(e),n.each(function(n){n.syncComponents()})},Aa=function(n){var e=n.components();U(e,Ma),Wo(n.element()),n.syncComponents()},Fa=function(t){var r=function(e){return oe(t.element()).fold(function(){return!0},function(n){return ee(e,n)})},o=Bi(),s=function(n,e){return o.find(r,n,e)},n=vi(t.element(),{triggerEvent:function(u,a){return ti(u,a.target(),function(n){return e=s,t=u,o=n,i=(r=a).target(),Oi(e,t,r,i,o);var e,t,r,o,i})}}),i={debugInfo:W("real"),triggerEvent:function(e,t,r){ti(e,t,function(n){Oi(s,e,r,t,n)})},triggerFocus:function(a,c){Di(a).fold(function(){Vo(a)},function(n){ti(Lr(),a,function(n){var e,t,r,o,i,u;e=s,t=Lr(),r={originator:W(c),kill:y,prevent:y,target:W(a)},i=n,u=pi(r,o=a),bi(e,t,r,o,u,i)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return g(n)},getByDom:function(n){return v(n)},build:yu,addToGui:function(n){a(n)},removeFromGui:function(n){c(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){u(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},broadcastEvent:function(n,e){m(n,e)},isConnected:W(!0)},e=function(n){n.connect(i),ye(n.element())||(o.register(n),U(n.components(),e),i.triggerEvent($r(),n.element(),{target:W(n.element())}))},u=function(n){ye(n.element())||(U(n.components(),u),o.unregister(n)),n.disconnect()},a=function(n){Ta(t,n)},c=function(n){Na(n)},f=function(t){var n=o.filter(zr());U(n,function(n){var e=n.descHandler();ii(e)(t)})},l=function(n){f({universal:W(!0),data:W(n)})},d=function(n,e){f({universal:W(!1),channels:W(n),data:W(e)})},m=function(n,e){var t=o.filter(n);return wi(t,e)},g=function(n){return o.getById(n).fold(function(){return Ie.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Ie.value)},v=function(n){var e=Di(n).getOr("not found");return g(e)};return e(t),{root:W(t),element:t.element,destroy:function(){n.unbind(),zo(t.element())},add:a,remove:c,getByUid:g,getByDom:v,addToWorld:e,removeFromWorld:u,broadcast:l,broadcastOn:d,broadcastEvent:m}},Ba=function(n){var e=void 0!==n.uid&&xt(n,"uid")?n.uid:Mi("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(A.none,A.some)},asSpec:function(){return Ne({},n,{uid:e})}}},Ra=Object.freeze({exhibit:function(n,e){return To({classes:[],styles:e.useFixed?{}:{position:"relative"}})}}),Ha=function(t,r){return{left:W(t),top:W(r),translate:function(n,e){return Ha(t+n,r+e)}}},Ia=Ha,Pa=function(n,e){return void 0!==n?n:void 0!==e?e:0},Va=function(n){var e,t,r=n.dom().ownerDocument,o=r.body,i=(e=x.fromDom(r),(t=e.dom())===t.window&&e instanceof b.Window?e:we(e)?t.defaultView||t.parentWindow:null),u=r.documentElement,a=Pa(i.pageYOffset,u.scrollTop),c=Pa(i.pageXOffset,u.scrollLeft),s=Pa(u.clientTop,o.clientTop),f=Pa(u.clientLeft,o.clientLeft);return ja(n).translate(c-f,a-s)},ja=function(n){var e,t,r,o=n.dom(),i=o.ownerDocument,u=i.body,a=x.fromDom(i.documentElement);return u===o?Ia(u.offsetLeft,u.offsetTop):(e=n,t=a||x.fromDom(b.document.documentElement),go(e,l(ee,t)).isSome()?(r=o.getBoundingClientRect(),Ia(r.left,r.top)):Ia(0,0))};function La(r,o){var n=function(n){var e=o(n);if(e<=0||null===e){var t=iu(n,r);return parseFloat(t)||0}return e},i=function(o,n){return q(n,function(n,e){var t=iu(o,e),r=void 0===t?0:parseInt(t,10);return isNaN(r)?n:n+r},0)};return{set:function(n,e){if(!H(e)&&!e.match(/^[0-9]+$/))throw new Error(r+".set accepts only positive integer values. Value was "+e);var t=n.dom();nu(t)&&(t.style[r]=e+"px")},get:n,getOuter:n,aggregate:i,max:function(n,e,t){var r=i(n,t);return r<e?e-r:0}}}var Ua=La("height",function(n){var e=n.dom();return ke(n)?e.getBoundingClientRect().height:e.offsetHeight}),Wa=function(n){return Ua.getOuter(n)},za=La("width",function(n){return n.dom().offsetWidth}),Ga=function(n){return za.getOuter(n)},qa=on("point","width","height"),Ya=on("x","y","width","height"),Ka=function(n,e,t,r){return{x:W(n),y:W(e),width:W(t),height:W(r),right:W(n+t),bottom:W(e+r)}},Xa=function(n){var e=Va(n),t=Ga(n),r=Wa(n);return Ka(e.left(),e.top(),t,r)},Qa=["valignCentre","alignLeft","alignRight","alignCentre","top","bottom","left","right"],$a=function(){return e=n=0,t={},o=function(n){return bt(t,n).getOr([])},r=function(n,e,t){var r=en(Qa,t);return{offset:function(){return Ia(n,e)},classesOn:function(){return J(t,o)},classesOff:function(){return J(r,o)}}},{southeast:function(){return r(-n,e,["top","alignLeft"])},southwest:function(){return r(n,e,["top","alignRight"])},south:function(){return r(-n/2,e,["top","alignCentre"])},northeast:function(){return r(-n,-e,["bottom","alignLeft"])},northwest:function(){return r(n,-e,["bottom","alignRight"])},north:function(){return r(-n/2,-e,["bottom","alignCentre"])},east:function(){return r(n,-e/2,["valignCentre","left"])},west:function(){return r(-n,-e/2,["valignCentre","right"])},innerNorthwest:function(){return r(-n,e,["top","alignRight"])},innerNortheast:function(){return r(n,e,["top","alignLeft"])},innerNorth:function(){return r(-n/2,e,["top","alignCentre"])},innerSouthwest:function(){return r(-n,-e,["bottom","alignRight"])},innerSoutheast:function(){return r(n,-e,["bottom","alignLeft"])},innerSouth:function(){return r(-n/2,-e,["bottom","alignCentre"])},innerWest:function(){return r(n,-e/2,["valignCentre","right"])},innerEast:function(){return r(-n,-e/2,["valignCentre","left"])}};var n,e,t,o,r},Ja=on("x","y","bubble","direction","label"),Za=tt([{southeast:[]},{southwest:[]},{northeast:[]},{northwest:[]},{south:[]},{north:[]},{east:[]},{west:[]}]),nc=Za.southeast,ec=Za.southwest,tc=Za.northeast,rc=Za.northwest,oc=Za.south,ic=Za.north,uc=Za.east,ac=Za.west,cc=function(n){return n.x()},sc=function(n,e){return n.x()+n.width()/2-e.width()/2},fc=function(n,e){return n.x()+n.width()-e.width()},lc=function(n,e){return n.y()-e.height()},dc=function(n){return n.y()+n.height()},mc=function(n,e){return n.y()+n.height()/2-e.height()/2},gc=function(n,e,t){return Ja(cc(n),dc(n),t.southeast(),nc(),"layout-se")},vc=function(n,e,t){return Ja(fc(n,e),dc(n),t.southwest(),ec(),"layout-sw")},pc=function(n,e,t){return Ja(cc(n),lc(n,e),t.northeast(),tc(),"layout-ne")},hc=function(n,e,t){return Ja(fc(n,e),lc(n,e),t.northwest(),rc(),"layout-nw")},bc=function(n,e,t){return Ja(sc(n,e),lc(n,e),t.north(),ic(),"layout-n")},yc=function(n,e,t){return Ja(sc(n,e),dc(n),t.south(),oc(),"layout-s")},wc=function(n,e,t){return Ja((r=n).x()+r.width(),mc(n,e),t.east(),uc(),"layout-e");var r},Oc=function(n,e,t){return Ja((r=e,n.x()-r.width()),mc(n,e),t.west(),ac(),"layout-w");var r},xc=function(){return[gc,vc,pc,hc,yc,bc,wc,Oc]},_c=function(){return[vc,gc,hc,pc,yc,bc,wc,Oc]},Sc=Yn.detect().browser.isSafari(),Ec=function(n){var e=void 0!==n?n.dom():b.document,t=e.body.scrollLeft||e.documentElement.scrollLeft,r=e.body.scrollTop||e.documentElement.scrollTop;return Ia(t,r)},Cc=function(n,e){Sc&&R(n.dom().scrollIntoViewIfNeeded)?n.dom().scrollIntoViewIfNeeded(!1):n.dom().scrollIntoView(e)},kc=vn(["x","y","width","height","maxHeight","direction","classes","label","candidateYforTest"],[]),Tc=on("position","left","top","right","bottom"),Dc=function(r,n){return r.view(n).fold(W([]),function(n){var e=r.owner(n),t=Dc(r,e);return[n].concat(t)})},Mc=Object.freeze({view:function(n){return(n.dom()===b.document?A.none():A.from(n.dom().defaultView.frameElement)).map(x.fromDom)},owner:function(n){return te(n)}}),Nc=function(r){var n,e,t,o,i=x.fromDom(b.document),u=Ec(i);return(n=r,t=(e=Mc).owner(n),o=Dc(e,t),A.some(o)).fold(l(Va,r),function(n){var e=ja(r),t=G(n,function(n,e){var t=ja(e);return{left:n.left+t.left(),top:n.top+t.top()}},{left:0,top:0});return Ia(t.left+e.left()+u.left(),t.top+e.top()+u.top())})},Ac=function(){var n=b.window.innerWidth,e=b.window.innerHeight,t=x.fromDom(b.document),r=Ec(t);return Ka(r.left(),r.top(),n,e)},Fc=tt([{none:[]},{relative:["x","y","width","height"]},{fixed:["x","y","width","height"]}]),Bc=function(n,e,t,r,o,i){var u,a,c,s,f,l,d,m,g,v=e.x()-t,p=e.y()-r,h=o-(v+e.width()),b=i-(p+e.height()),y=A.some(v),w=A.some(p),O=A.some(h),x=A.some(b),_=A.none();return u=e.direction(),a=function(){return Tc(n,y,w,_,_)},c=function(){return Tc(n,_,w,O,_)},s=function(){return Tc(n,y,_,_,x)},f=function(){return Tc(n,_,_,O,x)},l=function(){return Tc(n,y,w,_,_)},d=function(){return Tc(n,y,_,_,x)},m=function(){return Tc(n,y,w,_,_)},g=function(){return Tc(n,_,w,O,_)},u.fold(a,c,s,f,l,d,m,g)},Rc=function(n,e){var t=l(Nc,e),r=n.fold(t,t,function(){var n=Ec();return Nc(e).translate(-n.left(),-n.top())}),o=Ga(e),i=Wa(e);return Ka(r.left(),r.top(),o,i)},Hc=Fc.relative,Ic=Fc.fixed,Pc=function(n){return n},Vc=function(e,t){return function(n){return"rtl"===jc(n)?t:e}},jc=function(n){return"rtl"===iu(n,"direction")?"rtl":"ltr"},Lc=function(){return wr("layouts",[vr("onLtr"),vr("onRtl")])},Uc=function(e,n,t,r){var o=n.layouts.map(function(n){return n.onLtr(e)}).getOr(t),i=n.layouts.map(function(n){return n.onRtl(e)}).getOr(r);return Vc(o,i)(e)},Wc=[vr("hotspot"),br("bubble"),xr("overrides",{}),Lc(),Hu("placement",function(n,e,t){var r=e.hotspot,o=Rc(t,r.element()),i=Uc(n.element(),e,xc(),_c());return A.some(Pc({anchorBox:o,bubble:e.bubble.getOr($a()),overrides:e.overrides,layouts:i,placer:A.none()}))})],zc=[vr("x"),vr("y"),xr("height",0),xr("width",0),xr("bubble",$a()),xr("overrides",{}),Lc(),Hu("placement",function(n,e,t){var r=Ka(e.x,e.y,e.width,e.height),o=Uc(n.element(),e,xc(),_c());return A.some(Pc({anchorBox:r,bubble:e.bubble,overrides:e.overrides,layouts:o,placer:A.none()}))})],Gc={create:on("start","soffset","finish","foffset")},qc=tt([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Yc=(qc.before,qc.on,qc.after,function(n){return n.fold(s,s,s)}),Kc=tt([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Xc={domRange:Kc.domRange,relative:Kc.relative,exact:Kc.exact,exactFromRange:function(n){return Kc.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){var e=n.match({domRange:function(n){return x.fromDom(n.startContainer)},relative:function(n,e){return Yc(n)},exact:function(n,e,t,r){return n}});return re(e)},range:Gc.create},Qc=function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold(function(n){r.setStartBefore(n.dom())},function(n,e){r.setStart(n.dom(),e)},function(n){r.setStartAfter(n.dom())}),o=i,t.fold(function(n){o.setEndBefore(n.dom())},function(n,e){o.setEnd(n.dom(),e)},function(n){o.setEndAfter(n.dom())}),i},$c=function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},Jc=function(n){return{left:W(n.left),top:W(n.top),right:W(n.right),bottom:W(n.bottom),width:W(n.width),height:W(n.height)}},Zc=tt([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),ns=function(n,e,t){return e(x.fromDom(t.startContainer),t.startOffset,x.fromDom(t.endContainer),t.endOffset)},es=function(n,e){var o,t,r,i=(o=n,e.match({domRange:function(n){return{ltr:W(n),rtl:A.none}},relative:function(n,e){return{ltr:xn(function(){return Qc(o,n,e)}),rtl:xn(function(){return A.some(Qc(o,e,n))})}},exact:function(n,e,t,r){return{ltr:xn(function(){return $c(o,n,e,t,r)}),rtl:xn(function(){return A.some($c(o,t,r,n,e))})}}}));return(r=(t=i).ltr()).collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return Zc.rtl(x.fromDom(n.endContainer),n.endOffset,x.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return ns(0,Zc.ltr,r)}):ns(0,Zc.ltr,r)},ts=function(n,e,t){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom};var rs,os,is,us,as,cs,ss,fs,ls,ds=(rs=ye,os="text",is=function(n){return rs(n)?A.from(n.dom().nodeValue):A.none()},us=Yn.detect().browser,{get:function(n){if(!rs(n))throw new Error("Can only get "+os+" value of a "+os+" node");return as(n).getOr("")},getOption:as=us.isIE()&&10===us.version.major?function(n){try{return is(n)}catch(n){return A.none()}}:is,set:function(n,e){if(!rs(n))throw new Error("Can only set raw "+os+" value of a "+os+" node");n.dom().nodeValue=e}}),ms=function(n){return ds.get(n)},gs=function(t,r,n,e,o){var i=function(n){var e=t.dom().createRange();return e.setStart(r.dom(),n),e.collapse(!0),e},u=ms(r).length,a=function(n,e,t,r,o){if(0===o)return 0;if(e===r)return o-1;for(var i=r,u=1;u<o;u++){var a=n(u),c=Math.abs(e-a.left);if(t<=a.bottom){if(t<a.top||i<c)return u-1;i=c}}return 0}(function(n){return i(n).getBoundingClientRect()},n,e,o.right,u);return i(a)},vs=function(e,t,r,o){var n=e.dom().createRange();n.selectNode(t.dom());var i=n.getClientRects();return qo(i,function(n){return ts(n,r,o)?A.some(n):A.none()}).map(function(n){return gs(e,t,r,o,n)})},ps=function(e,n,t,r){var o=e.dom().createRange(),i=ie(n);return qo(i,function(n){return o.selectNode(n.dom()),ts(o.getBoundingClientRect(),t,r)?hs(e,n,t,r):A.none()})},hs=function(n,e,t,r){return(ye(e)?vs:ps)(n,e,t,r)},bs=function(n){return(e=n,ds.getOption(e)).filter(function(n){return 0!==n.trim().length||-1<n.indexOf("")}).isSome();var e},ys=["img","br"],ws=function(n){return bs(n)||V(ys,pe(n))},Os=function(n){return po(n,ws)},xs=function(n){return _s(n,ws)},_s=function(n,i){var u=function(n){for(var e=ie(n),t=e.length-1;0<=t;t--){var r=e[t];if(i(r))return A.some(r);var o=u(r);if(o.isSome())return o}return A.none()};return u(n)},Ss=function(n,e){return e-n.left<n.right-e},Es=function(n,e,t){var r=n.dom().createRange();return r.selectNode(e.dom()),r.collapse(t),r},Cs=function(e,n,t){var r=e.dom().createRange();r.selectNode(n.dom());var o=r.getBoundingClientRect(),i=Ss(o,t);return(!0===i?Os:xs)(n).map(function(n){return Es(e,n,i)})},ks=function(n,e,t){var r=e.dom().getBoundingClientRect(),o=Ss(r,t);return A.some(Es(n,e,o))},Ts=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect();return function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,t)),a=Math.max(i.top,Math.min(i.bottom,r));return hs(n,e,u,a)}(n,e,Math.max(i.left,Math.min(i.right,t)),Math.max(i.top,Math.min(i.bottom,r)))},Ds=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e,t,r){var o,i,u,a,c,s=(i=e,u=t,a=r,(c=te(o=n).dom().createRange()).setStart(o.dom(),i),c.setEnd(u.dom(),a),c),f=ee(n,t)&&e===r;return s.collapsed&&!f}),Ms=function(n){var e=x.fromDom(n.anchorNode),t=x.fromDom(n.focusNode);return Ds(e,n.anchorOffset,t,n.focusOffset)?A.some(Gc.create(e,n.anchorOffset,t,n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return A.some(Gc.create(x.fromDom(e.startContainer),e.startOffset,x.fromDom(t.endContainer),t.endOffset))}return A.none()}(n)},Ns=function(n,e){var i,t,r,o,u=es(i=n,e).match({ltr:function(n,e,t,r){var o=i.document.createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},rtl:function(n,e,t,r){var o=i.document.createRange();return o.setStart(t.dom(),r),o.setEnd(n.dom(),e),o}});return r=(t=u).getClientRects(),0<(o=0<r.length?r[0]:t.getBoundingClientRect()).width||0<o.height?A.some(o).map(Jc):A.none()},As=on("element","offset"),Fs=tt([{screen:["point"]},{absolute:["point","scrollLeft","scrollTop"]}]),Bs=function(n){return n.fold(function(n){return n},function(n,e,t){return n.translate(-e,-t)})},Rs=function(n){return n.fold(function(n){return n},function(n,e,t){return n})},Hs=function(n){return q(n,function(n,e){return n.translate(e.left(),e.top())},Ia(0,0))},Is=function(n){var e=L(n,Rs);return Hs(e)},Ps=Fs.screen,Vs=Fs.absolute,js=function(n,e,t){var r,o,i,u=te(n.element()),a=Ec(u),c=(r=n,o=t,i=re(o.root).dom(),A.from(i.frameElement).map(x.fromDom).filter(function(n){var e=te(n),t=te(r.element());return ee(e,t)}).map(Va)).getOr(a);return Vs(c,a.left(),a.top())},Ls=function(n,e,t,r){var o=n,i=e,u=t,a=r;n<0&&(o=0,u=t+n),e<0&&(i=0,a=r+e);var c=Ps(Ia(o,i));return A.some(qa(c,u,a))},Us=function(n,c,s,f,l){return n.map(function(n){var e,t,r,o=[c,n.point()],i=(e=function(){return Is(o)},t=function(){return Is(o)},r=function(){return n=L(o,Bs),Hs(n);var n},f.fold(e,t,r)),u=Ya(i.left(),i.top(),n.width(),n.height()),a=Uc(l,s,s.showAbove?[pc,hc,gc,vc,bc,yc]:[gc,vc,pc,hc,yc,yc],s.showAbove?[hc,pc,vc,gc,bc,yc]:[vc,gc,hc,pc,yc,bc]);return Pc({anchorBox:u,bubble:s.bubble.getOr($a()),overrides:s.overrides,layouts:a,placer:A.none()})})},Ws=on("element","offset"),zs=function(n,e){return ye(n)?Ws(n,e):function(n,e){var t=ie(n);if(0===t.length)return As(n,e);if(e<t.length)return As(t[e],0);var r=t[t.length-1],o=ye(r)?ms(r).length:ie(r).length;return As(r,o)}(n,e)},Gs=function(e,n){return n.getSelection.getOrThunk(function(){return function(){return n=e,A.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(Ms);var n}})().map(function(n){var e=zs(n.start(),n.soffset()),t=zs(n.finish(),n.foffset());return Xc.range(e.element(),e.offset(),t.element(),t.offset())})},qs=[br("getSelection"),vr("root"),br("bubble"),Lc(),xr("overrides",{}),xr("showAbove",!1),Hu("placement",function(n,e,t){var r=re(e.root).dom(),o=js(n,0,e),i=Gs(r,e).bind(function(n){return Ns(r,Xc.exactFromRange(n)).orThunk(function(){var e=x.fromText("\ufeff");return ce(n.start(),e),Ns(r,Xc.exact(e,0,e,1)).map(function(n){return zo(e),n})}).bind(function(n){return Ls(n.left(),n.top(),n.width(),n.height())})}),u=Gs(r,e).bind(function(n){return be(n.start())?A.some(n.start()):oe(n.start())}).getOr(n.element());return Us(i,o,e,t,u)})],Ys=[vr("node"),vr("root"),br("bubble"),Lc(),xr("overrides",{}),xr("showAbove",!1),Hu("placement",function(o,i,u){var a=js(o,0,i);return i.node.bind(function(n){var e=n.dom().getBoundingClientRect(),t=Ls(e.left,e.top,e.width,e.height),r=i.node.getOr(o.element());return Us(t,a,i,u,r)})})],Ks=function(n){return n.x()+n.width()},Xs=function(n,e){return n.x()-e.width()},Qs=function(n,e){return n.y()-e.height()+n.height()},$s=function(n){return n.y()},Js=function(n,e,t){return Ja(Ks(n),$s(n),t.southeast(),nc(),"link-layout-se")},Zs=function(n,e,t){return Ja(Xs(n,e),$s(n),t.southwest(),ec(),"link-layout-sw")},nf=function(n,e,t){return Ja(Ks(n),Qs(n,e),t.northeast(),tc(),"link-layout-ne")},ef=function(n,e,t){return Ja(Xs(n,e),Qs(n,e),t.northwest(),rc(),"link-layout-nw")},tf=[vr("item"),Lc(),xr("overrides",{}),Hu("placement",function(n,e,t){var r=Rc(t,e.item.element()),o=Uc(n.element(),e,[Js,Zs,nf,ef],[Zs,Js,ef,nf]);return A.some(Pc({anchorBox:r,bubble:$a(),overrides:e.overrides,layouts:o,placer:A.none()}))})],rf=fr("anchor",{selection:qs,node:Ys,hotspot:Wc,submenu:tf,makeshift:zc}),of=on("anchorBox","origin"),uf=tt([{fit:["reposition"]},{nofit:["reposition","deltaW","deltaH"]}]),af=function(n,I,P,V,j){var L=P.width(),U=P.height(),r=function(n,r,o,i){var e,t,u,a,c,s,f,l,d,m,g,v,p,h,b,y,w,O,x,_,S,E,C,k,T,D,M,N,A,F,B,R,H=n(I,P,V);return(t=L,u=U,a=j,d=(e=H).x(),m=e.y(),g=e.bubble().offset().left(),v=e.bubble().offset().top(),p=a.x(),h=a.y(),b=a.width(),y=a.height(),_=h<=(O=m+v),S=(x=p<=(w=d+g))&&_,E=w+t<=p+b&&O+u<=h+y,C=x?Math.min(t,p+b-w):Math.abs(p-(w+t)),k=_?Math.min(u,h+y-O):Math.abs(h-(O+u)),T=a.x()+a.width(),D=Math.max(a.x(),w),M=Math.min(D,T),A=W((N=_?O:O+(u-k))+k-h),F=W(h+y-N),c=e.direction(),f=s=F,l=A,B=c.fold(s,s,l,l,s,l,f,f),R=kc({x:M,y:N,width:C,height:k,maxHeight:B,direction:e.direction(),classes:{on:e.bubble().classesOn(),off:e.bubble().classesOff()},label:e.label(),candidateYforTest:O}),S&&E?uf.fit(R):uf.nofit(R,C,k)).fold(uf.fit,function(n,e,t){return i<t||o<e?uf.nofit(n,e,t):uf.nofit(r,o,i)})};return q(n,function(n,e){var t=l(r,e);return n.fold(uf.fit,t)},uf.nofit(kc({x:I.x(),y:I.y(),width:P.width(),height:P.height(),maxHeight:P.height(),direction:nc(),classes:[],label:"none",candidateYforTest:I.y()}),-1,-1)).fold(s,s)},cf=function(n,e,t,r){cu(e,"max-height");var o,i={width:W(Ga(o=e)),height:W(Wa(o))};return af(r.preference(),n,i,t,r.bounds())},sf=function(n,e,t){var r,o,i,u,a,c=function(n){return n+"px"},s=(r=t.origin(),o=e,r.fold(function(){return Tc("absolute",A.some(o.x()),A.some(o.y()),A.none(),A.none())},function(n,e,t,r){return Bc("absolute",o,n,e,t,r)},function(n,e,t,r){return Bc("fixed",o,n,e,t,r)}));i=n,u={position:A.some(s.position()),left:s.left().map(c),top:s.top().map(c),right:s.right().map(c),bottom:s.bottom().map(c)},a=i.dom(),cn(u,function(n,e){n.fold(function(){tu(a,e)},function(n){eu(a,e,n)})})},ff=function(n,e){var t,r,o;t=n,r=Math.floor(e),o=Ua.max(t,r,["margin-top","border-top-width","padding-top","padding-bottom","border-bottom-width","margin-bottom"]),ru(t,"max-height",o+"px")},lf=W(function(n,e){ff(n,e),ou(n,{"overflow-x":"hidden","overflow-y":"auto"})}),df=vn(["bounds","origin","preference","maxHeightFunction"],[]),mf=function(n,e,t,r,o,i){var u,a,c,s,f,l=(u=i,a="maxHeightFunction",c=lf(),void 0===u[a]?c:u[a]),d=n.anchorBox(),m=n.origin(),g=df({bounds:(s=m,f=o,f.fold(function(){return s.fold(Ac,Ac,Ka)},function(n){return s.fold(n,n,Ka)})),origin:m,preference:r,maxHeightFunction:l});gf(d,e,t,g)},gf=function(n,e,t,r){var o,i,u,a,c=cf(n,e,t,r);sf(e,c,r),o=e,i=c.classes(),Zi(o,i.off),Ji(o,i.on),u=e,a=c,r.maxHeightFunction()(u,a.maxHeight())},vf=function(n,e,t,r,o){var i,u=(i=t.anchorBox,of(i,e));mf(u,o.element(),t.bubble,t.layouts,r,t.overrides)},pf=function(n,e,t,r,o,i){var u=i.map(Xa);return hf(n,e,t,r,o,u)},hf=function(e,n,t,r,o,i){var u=cr("positioning anchor.info",rf,r);ru(o.element(),"position","fixed");var a=au(o.element(),"visibility");ru(o.element(),"visibility","hidden");var c,s,f,l=n.useFixed?Ic(0,0,b.window.innerWidth,b.window.innerHeight):(s=Va((c=e).element()),f=c.element().dom().getBoundingClientRect(),Hc(s.left(),s.top(),f.width,f.height)),d=u.placement,m=i.map(W).or(n.getBounds);d(e,u,l).each(function(n){n.placer.getOr(vf)(e,l,n,m,o)}),a.fold(function(){cu(o.element(),"visibility")},function(n){ru(o.element(),"visibility",n)}),au(o.element(),"left").isNone()&&au(o.element(),"top").isNone()&&au(o.element(),"right").isNone()&&au(o.element(),"bottom").isNone()&&au(o.element(),"position").is("fixed")&&cu(o.element(),"position")},bf=Object.freeze({position:function(n,e,t,r,o){var i=A.none();pf(n,e,t,r,o,i)},positionWithin:pf,positionWithinBounds:hf,getMode:function(n,e,t){return e.useFixed?"fixed":"absolute"}}),yf=[xr("useFixed",!1),br("getBounds")],wf=Ro({fields:yf,name:"positioning",active:Ra,apis:bf}),Of=function(n,e,t,r){var o=n.getSystem().build(r);Da(n,o,t)},xf=function(n,e,t,r){var o=_f(n);Y(o,function(n){return ee(r.element(),n.element())}).each(Na)},_f=function(n,e){return n.components()},Sf=function(e,n,t,o,r){var i=_f(e);return A.from(i[o]).map(function(n){return xf(e,0,0,n),r.each(function(n){Of(e,0,function(n,e){var t,r;r=e,ue(t=n,o).fold(function(){fe(t,r)},function(n){ce(n,r)})},n)}),n})},Ef=Ro({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,r){Of(n,0,fe,r)},prepend:function(n,e,t,r){Of(n,0,se,r)},remove:xf,replaceAt:Sf,replaceBy:function(e,n,t,r,o){var i=_f(e);return K(i,r).bind(function(n){return Sf(e,0,0,n,o)})},set:function(e,n,t,r){var o,i,u,a;Aa(e),o=function(){var n=L(r,e.getSystem().build);U(n,function(n){Ta(e,n)})},i=e.element(),u=te(i),a=jo(u).bind(function(e){var n=function(n){return ee(e,n)};return n(i)?A.some(i):po(i,n)}),o(i),a.each(function(e){jo(u).filter(function(n){return ee(n,e)}).fold(function(){Vo(e)},y)})},contents:_f})}),Cf=function(n){var e,t=n.dom();return!((e=t).offsetWidth<=0&&e.offsetHeight<=0)},kf=Object.freeze({getCurrent:function(n,e,t){return e.find(n)}}),Tf=[vr("find")],Df=Ro({fields:Tf,name:"composing",apis:kf}),Mf=function(n,e){e.ignore||(Vo(n.element()),e.onFocus(n))},Nf=Object.freeze({focus:Mf,blur:function(n,e){e.ignore||n.element().dom().blur()},isFocused:function(n){return e=n.element(),t=te(e).dom(),e.dom()===t.activeElement;var e,t}}),Af=Object.freeze({exhibit:function(n,e){var t=e.ignore?{}:{attributes:{tabindex:"-1"}};return To(t)},events:function(t){return bo([yo(Lr(),function(n,e){Mf(n,t),e.stop()})].concat(t.stopMousedown?[yo(Fr(),function(n,e){e.event().prevent()})]:[]))}}),Ff=[Au("onFocus"),xr("stopMousedown",!1),xr("ignore",!1)],Bf=Ro({fields:Ff,name:"focusing",active:Af,apis:Nf}),Rf=function(n,e,t){e.store.manager.onLoad(n,e,t)},Hf=function(n,e,t){e.store.manager.onUnload(n,e,t)},If=Object.freeze({onLoad:Rf,onUnload:Hf,setValue:function(n,e,t,r){e.store.manager.setValue(n,e,t,r)},getValue:function(n,e,t){return e.store.manager.getValue(n,e,t)},getState:function(n,e,t){return t}}),Pf=Object.freeze({events:function(t,r){var n=t.resetOnDom?[xo(function(n,e){Rf(n,t,r)}),_o(function(n,e){Hf(n,t,r)})]:[Do(t,r,Rf)];return bo(n)}}),Vf=function(){var n=le(null);return Cr({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},jf=function(){var i=le({}),u=le({});return Cr({readState:function(){return{mode:"dataset",dataByValue:i.get(),dataByText:u.get()}},lookup:function(n){return bt(i.get(),n).orThunk(function(){return bt(u.get(),n)})},update:function(n){var e=i.get(),t=u.get(),r={},o={};U(n,function(e){r[e.value]=e,bt(e,"meta").each(function(n){bt(n,"text").each(function(n){o[n]=e})})}),i.set(Ne({},e,r)),u.set(Ne({},t,o))},clear:function(){i.set({}),u.set({})}})},Lf=Object.freeze({memory:Vf,dataset:jf,manual:function(){return Cr({readState:function(){}})},init:function(n){return n.store.manager.state(n)}}),Uf=function(n,e,t,r){var o=e.store;t.update([r]),o.setValue(n,r),e.onSetValue(n,r)},Wf=[br("initialValue"),vr("getFallbackEntry"),vr("getDataKey"),vr("setValue"),Hu("manager",{setValue:Uf,getValue:function(n,e,t){var r=e.store,o=r.getDataKey(n);return t.lookup(o).fold(function(){return r.getFallbackEntry(o)},function(n){return n})},onLoad:function(e,t,r){t.store.initialValue.each(function(n){Uf(e,t,r,n)})},onUnload:function(n,e,t){t.clear()},state:jf})],zf=[vr("getValue"),xr("setValue",y),br("initialValue"),Hu("manager",{setValue:function(n,e,t,r){e.store.setValue(n,r),e.onSetValue(n,r)},getValue:function(n,e,t){return e.store.getValue(n)},onLoad:function(e,t,n){t.store.initialValue.each(function(n){t.store.setValue(e,n)})},onUnload:y,state:Er.init})],Gf=[br("initialValue"),Hu("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store.initialValue.each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:Vf})],qf=[_r("store",{mode:"memory"},fr("mode",{memory:Gf,manual:zf,dataset:Wf})),Au("onSetValue"),xr("resetOnDom",!1)],Yf=Ro({fields:qf,name:"representing",active:Pf,apis:If,extra:{setValueFrom:function(n,e){var t=Yf.getValue(e);Yf.setValue(n,t)}},state:Lf}),Kf=Object.freeze({exhibit:function(n,e){return To({attributes:wt([{key:e.tabAttr,value:"true"}])})}}),Xf=[xr("tabAttr","data-alloy-tabstop")],Qf=Ro({fields:Xf,name:"tabstopping",active:Kf}),$f=function(n,e,t,r){return bt(e.routes,r.start).bind(function(n){return bt(n,r.destination)})},Jf=function(n,e,t,r){return $f(0,e,0,r).bind(function(e){return e.transition.map(function(n){return{transition:n,route:e}})})},Zf=function(t,r,n){var e,o,i;(e=t,o=r,i=n,nl(e,o).bind(function(n){return Jf(e,o,i,n)})).each(function(n){var e=n.transition;Ke(t.element(),e.transitionClass),Ce(t.element(),r.destinationAttr)})},nl=function(n,e,t){var r=n.element();return Ee(r,e.destinationAttr)?A.some({start:Se(n.element(),e.stateAttr),destination:Se(n.element(),e.destinationAttr)}):A.none()},el=function(n,e,t,r){Zf(n,e,t),Ee(n.element(),e.stateAttr)&&Se(n.element(),e.stateAttr)!==r&&e.onFinish(n,r),xe(n.element(),e.stateAttr,r)},tl=Object.freeze({findRoute:$f,disableTransition:Zf,getCurrentRoute:nl,jumpTo:el,progressTo:function(t,r,o,i){var n,e;e=r,Ee((n=t).element(),e.destinationAttr)&&(xe(n.element(),e.stateAttr,Se(n.element(),e.destinationAttr)),Ce(n.element(),e.destinationAttr));var u,a,c=(u=r,a=i,{start:Se(t.element(),u.stateAttr),destination:a});Jf(t,r,o,c).fold(function(){el(t,r,o,i)},function(n){Zf(t,r,o);var e=n.transition;qe(t.element(),e.transitionClass),xe(t.element(),r.destinationAttr,i)})},getState:function(n,e,t){var r=n.element();return Ee(r,e.stateAttr)?A.some(Se(r,e.stateAttr)):A.none()}}),rl=Object.freeze({events:function(o,i){return bo([yo(Vr(),function(t,n){var r=n.event().raw();nl(t,o).each(function(e){$f(0,o,0,e).each(function(n){n.transition.each(function(n){r.propertyName===n.property&&(el(t,o,i,e.destination),o.onTransition(t,e))})})})}),xo(function(n,e){el(n,o,i,o.initialState)})])}}),ol=[xr("destinationAttr","data-transitioning-destination"),xr("stateAttr","data-transitioning-state"),vr("initialState"),Au("onTransition"),Au("onFinish"),pr("routes",ir(Ie.value,ir(Ie.value,Xt([Or("transition",[vr("property"),vr("transitionClass")])]))))],il=Ro({fields:ol,name:"transitioning",active:rl,apis:tl,extra:{createRoutes:function(n){var r={};return cn(n,function(n,e){var t=e.split("<->");r[t[0]]=yt(t[1],n),r[t[1]]=yt(t[0],n)}),r},createBistate:function(n,e,t){return wt([{key:n,value:yt(e,t)},{key:e,value:yt(n,t)}])},createTristate:function(n,e,t,r){return wt([{key:n,value:wt([{key:e,value:r},{key:t,value:r}])},{key:e,value:wt([{key:n,value:r},{key:t,value:r}])},{key:t,value:wt([{key:n,value:r},{key:e,value:r}])}])}}}),ul=Yn.detect().os.isOSX()?"":"Ctrl",al=sn({tc_menu_name:"TinyComments",tc_announce_sidebar_available:"Comment. Sidebar available. Press "+ul+" + Alt + M to switch to sidebar",tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_save:"Save",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Say something ...",tc_kebab_deleteconversation:"Delete conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the Console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_create_problem:"An error occurred while creating a comment. See the Console for details",tc_reply_problem:"An error occurred while replying to a comment. See the Console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_delete_problem_all:"An error occurred deleting all the conversations. See the Console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the Console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the Console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_comment_buttons_showmore:"SHOW MORE",tc_comment_buttons_showless:"SHOW LESS"},s),cl=function(n,e,t){var r=e.aria;r.update(n,r,t.get())},sl=function(e,n,t){n.toggleClass.each(function(n){t.get()?qe(e.element(),n):Ke(e.element(),n)})},fl=function(n,e,t){ml(n,e,t,!t.get())},ll=function(n,e,t){t.set(!0),sl(n,e,t),cl(n,e,t)},dl=function(n,e,t){t.set(!1),sl(n,e,t),cl(n,e,t)},ml=function(n,e,t,r){(r?ll:dl)(n,e,t)},gl=function(n,e,t){ml(n,e,t,e.selected)},vl=Object.freeze({onLoad:gl,toggle:fl,isOn:function(n,e,t){return t.get()},on:ll,off:dl,set:ml}),pl=Object.freeze({exhibit:function(n,e,t){return To({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=fl,Eo(function(n){o(n,t,r)})),u=Do(n,e,gl);return bo($([n.toggleOnExecute?[i]:[],[u]]))}}),hl=function(n,e,t){xe(n.element(),"aria-expanded",t)},bl=[xr("selected",!1),br("toggleClass"),xr("toggleOnExecute",!0),_r("aria",{mode:"none"},fr("mode",{pressed:[xr("syncWithExpanded",!1),Hu("update",function(n,e,t){xe(n.element(),"aria-pressed",t),e.syncWithExpanded&&hl(n,e,t)})],checked:[Hu("update",function(n,e,t){xe(n.element(),"aria-checked",t)})],expanded:[Hu("update",hl)],selected:[Hu("update",function(n,e,t){xe(n.element(),"aria-selected",t)})],none:[Hu("update",y)]}))],yl=Ro({fields:bl,name:"toggling",active:pl,apis:vl,state:(cs=!1,{init:function(){var e=le(cs);return{get:function(){return e.get()},set:function(n){return e.set(n)},clear:function(){return e.set(cs)},readState:function(){return e.get()}}}})}),wl=function(n){var e=function(n,e){e.stop(),uo(n)},t=Yn.detect().deviceType.isTouch()?[yo(Yr(),e)]:[yo(Pr(),e),yo(Fr(),function(n,e){e.cut()})];return bo($([n.map(function(t){return yo(Gr(),function(n,e){t(n),e.stop()})}).toArray(),t]))},Ol=function(n,e,t){var r=nn(n.slice(0,e)),o=nn(n.slice(e+1));return Y(r.concat(o),t)},xl=function(n,e,t){var r=nn(n.slice(0,e));return Y(r,t)},_l=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return Y(o.concat(r),t)},Sl=function(n,e,t){var r=n.slice(e+1);return Y(r,t)},El=function(t){return function(n){var e=n.raw();return V(t,e.which)}},Cl=function(n){return function(e){return Z(n,function(n){return n(e)})}},kl=function(n){return!0===n.raw().shiftKey},Tl=function(n){return!0===n.raw().ctrlKey},Dl=(ss=kl,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!ss.apply(null,n)}),Ml=function(n,e){return{matches:n,classification:e}},Nl=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},Al=function(n,e,t){return n<=e?e:t<=n?t:n},Fl=function(t,r,n,o){var e=Qe(t.element(),"."+r.highlightClass);U(e,function(e){j(o,function(n){return n.element()===e})||(Ke(e,r.highlightClass),t.getSystem().getByDom(e).each(function(n){r.onDehighlight(t,n),oo(n,ro())}))})},Bl=function(n,e,t,r){Fl(n,e,0,[r]),Rl(n,e,t,r)||(qe(r.element(),e.highlightClass),e.onHighlight(n,r),oo(r,to()))},Rl=function(n,e,t,r){return Xe(r.element(),e.highlightClass)},Hl=function(n,e,t,r){var o=Qe(n.element(),"."+e.itemClass);return A.from(o[r]).fold(function(){return Ie.error("No element found with index "+r)},n.getSystem().getByDom)},Il=function(e,n,t){return ai(e.element(),"."+n.itemClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},Pl=function(e,n,t){var r=Qe(e.element(),"."+n.itemClass);return(0<r.length?A.some(r[r.length-1]):A.none()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},Vl=function(t,e,n,r){var o=Qe(t.element(),"."+e.itemClass);return K(o,function(n){return Xe(n,e.highlightClass)}).bind(function(n){var e=Nl(n,r,0,o.length-1);return t.getSystem().getByDom(o[e]).toOption()})},jl=function(e,n,t){var r=Qe(e.element(),"."+n.itemClass);return Go(L(r,function(n){return e.getSystem().getByDom(n).toOption()}))},Ll=Object.freeze({dehighlightAll:function(n,e,t){return Fl(n,e,0,[])},dehighlight:function(n,e,t,r){Rl(n,e,t,r)&&(Ke(r.element(),e.highlightClass),e.onDehighlight(n,r),oo(r,ro()))},highlight:Bl,highlightFirst:function(e,t,r){Il(e,t).each(function(n){Bl(e,t,r,n)})},highlightLast:function(e,t,r){Pl(e,t).each(function(n){Bl(e,t,r,n)})},highlightAt:function(e,t,r,n){Hl(e,t,r,n).fold(function(n){throw new Error(n)},function(n){Bl(e,t,r,n)})},highlightBy:function(e,t,r,n){var o=jl(e,t);Y(o,n).each(function(n){Bl(e,t,r,n)})},isHighlighted:Rl,getHighlighted:function(e,n,t){return ai(e.element(),"."+n.highlightClass).bind(function(n){return e.getSystem().getByDom(n).toOption()})},getFirst:Il,getLast:Pl,getPrevious:function(n,e,t){return Vl(n,e,0,-1)},getNext:function(n,e,t){return Vl(n,e,0,1)},getCandidates:jl}),Ul=[vr("highlightClass"),vr("itemClass"),Au("onHighlight"),Au("onDehighlight")],Wl=Ro({fields:Ul,name:"highlighting",apis:Ll}),zl=function(n,e,t){e.exists(function(e){return t.exists(function(n){return ee(n,e)})})||io(n,eo(),{prevFocus:e,newFocus:t})},Gl=function(){var o=function(n){return Lo(n.element())};return{get:o,set:function(n,e){var t=o(n);n.getSystem().triggerFocus(e,n.element());var r=o(n);zl(n,t,r)}}};(ls=fs||(fs={})).OnFocusMode="onFocus",ls.OnEnterOrSpaceMode="onEnterOrSpace",ls.OnApiMode="onApi";var ql,Yl,Kl,Xl,Ql,$l,Jl,Zl,nd,ed,td,rd,od,id,ud=function(n,e,t,r,a){var c=function(e,t,n,r,o){var i,u,a=n(e,t,r,o);return(i=a,u=t.event(),Y(i,function(n){return n.matches(u)}).map(function(n){return n.classification})).bind(function(n){return n(e,t,r,o)})},o={schema:function(){return n.concat([xr("focusManager",Gl()),_r("focusInside","onFocus",or(function(n){return V(["onFocus","onEnterOrSpace","onApi"],n)?Ie.value(n):Ie.error("Invalid value for focusInside")})),Hu("handler",o),Hu("state",e),Hu("sendFocusIn",a)])},processKey:c,toEvents:function(i,u){var n=i.focusInside!==fs.OnFocusMode?A.none():a(i).map(function(t){return yo(Lr(),function(n,e){t(n,i,u),e.stop()})});return bo(n.toArray().concat([yo(Rr(),function(r,o){c(r,o,t,i,u).fold(function(){var e,t,n;e=r,t=o,n=El([32].concat([13]))(t.event()),i.focusInside===fs.OnEnterOrSpaceMode&&n&&kr(e,t)&&a(i).each(function(n){n(e,i,u),t.stop()})},function(n){o.stop()})}),yo(Hr(),function(n,e){c(n,e,r,i,u).each(function(n){e.stop()})})]))}};return o},ad=function(n){var e=[br("onEscape"),br("onEnter"),xr("selector",'[data-alloy-tabstop="true"]'),xr("firstTabstop",0),xr("useTabstopAt",W(!0)),br("visibilitySelector")].concat([n]),u=function(n,e){var t,r=n.visibilitySelector.bind(function(n){return ci(e,n)}).getOr(e);return t=r,0<Ua.get(t)},t=function(e,t){var n,r,o,i;(n=e,r=t,o=Qe(n.element(),r.selector),i=z(o,function(n){return u(r,n)}),A.from(i[r.firstTabstop])).each(function(n){t.focusManager.set(e,n)})},a=function(e,n,t,r,o){return o(n,t,function(n){return u(e=r,t=n)&&e.useTabstopAt(t);var e,t}).fold(function(){return r.cyclic?A.some(!0):A.none()},function(n){return r.focusManager.set(e,n),A.some(!0)})},i=function(e,n,t,r){var o,i,u=Qe(e.element(),t.selector);return(o=e,i=t,i.focusManager.get(o).bind(function(n){return ci(n,i.selector)})).bind(function(n){return K(u,l(ee,n)).bind(function(n){return a(e,u,n,t,r)})})},r=W([Ml(Cl([kl,El([9])]),function(n,e,t,r){var o=t.cyclic?Ol:xl;return i(n,0,t,o)}),Ml(El([9]),function(n,e,t,r){var o=t.cyclic?_l:Sl;return i(n,0,t,o)}),Ml(El([27]),function(e,t,n,r){return n.onEscape.bind(function(n){return n(e,t)})}),Ml(Cl([Dl,El([13])]),function(e,t,n,r){return n.onEnter.bind(function(n){return n(e,t)})})]),o=W([]);return ud(e,Er.init,r,o,function(){return A.some(t)})},cd=ad(Sr("cyclic",W(!1))),sd=ad(Sr("cyclic",W(!0))),fd=function(n){return"input"===pe(n)&&"radio"!==Se(n,"type")||"textarea"===pe(n)},ld=function(n,e,t){return fd(t)&&El([32])(e.event())?A.none():(ao(n,t,Gr()),A.some(!0))},dd=function(n,e){return A.some(!0)},md=[xr("execute",ld),xr("useSpace",!1),xr("useEnter",!0),xr("useControlEnter",!1),xr("useDown",!1)],gd=function(n,e,t){return t.execute(n,e,n.element())},vd=ud(md,Er.init,function(n,e,t,r){var o=t.useSpace&&!fd(n.element())?[32]:[],i=t.useEnter?[13]:[],u=t.useDown?[40]:[],a=o.concat(i).concat(u);return[Ml(El(a),gd)].concat(t.useControlEnter?[Ml(Cl([Tl,El([13])]),gd)]:[])},function(n,e,t,r){return t.useSpace&&!fd(n.element())?[Ml(El([32]),dd)]:[]},function(){return A.none()}),pd=function(n){var t=le(A.none());return Cr({readState:function(){return t.get().map(function(n){return{numRows:n.numRows(),numColumns:n.numColumns()}}).getOr({numRows:"?",numColumns:"?"})},setGridSize:function(n,e){t.set(A.some({numRows:W(n),numColumns:W(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},hd=Object.freeze({flatgrid:pd,init:function(n){return n.state(n)}}),bd=function(i){return function(n,e,t,r){var o=i(n.element());return xd(o,n,e,t,r)}},yd=function(n,e){var t=Vc(n,e);return bd(t)},wd=function(n,e){var t=Vc(e,n);return bd(t)},Od=function(o){return function(n,e,t,r){return xd(o,n,e,t,r)}},xd=function(e,t,n,r,o){return r.focusManager.get(t).bind(function(n){return e(t.element(),n,r,o)}).map(function(n){return r.focusManager.set(t,n),!0})},_d=Od,Sd=Od,Ed=Od,Cd=vn(["index","candidates"],[]),kd=function(n,e,t){var r,o=l(ee,e),i=Qe(n,t),u=z(i,Cf);return K(r=u,o).map(function(n){return Cd({index:n,candidates:r})})},Td=function(n,e){return K(n,function(n){return ee(e,n)})},Dd=function(t,n,r,e){return e(Math.floor(n/r),n%r).bind(function(n){var e=n.row()*r+n.column();return 0<=e&&e<t.length?A.some(t[e]):A.none()})},Md=function(o,n,i,u,a){return Dd(o,n,u,function(n,e){var t=n===i-1?o.length-n*u:u,r=Nl(e,a,0,t-1);return A.some({row:W(n),column:W(r)})})},Nd=function(i,n,u,a,c){return Dd(i,n,a,function(n,e){var t=Nl(n,c,0,u-1),r=t===u-1?i.length-t*a:a,o=Al(e,0,r-1);return A.some({row:W(t),column:W(o)})})},Ad=[vr("selector"),xr("execute",ld),Fu("onEscape"),xr("captureTab",!1),Pu()],Fd=function(e,t,n){ai(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},Bd=function(o){return function(n,e,t,r){return kd(n,e,t.selector).bind(function(n){return o(n.candidates(),n.index(),r.getNumRows().getOr(t.initSize.numRows),r.getNumColumns().getOr(t.initSize.numColumns))})}},Rd=function(n,e,t,r){return t.captureTab?A.some(!0):A.none()},Hd=Bd(function(n,e,t,r){return Md(n,e,t,r,-1)}),Id=Bd(function(n,e,t,r){return Md(n,e,t,r,1)}),Pd=Bd(function(n,e,t,r){return Nd(n,e,t,r,-1)}),Vd=Bd(function(n,e,t,r){return Nd(n,e,t,r,1)}),jd=W([Ml(El([37]),yd(Hd,Id)),Ml(El([39]),wd(Hd,Id)),Ml(El([38]),_d(Pd)),Ml(El([40]),Sd(Vd)),Ml(Cl([kl,El([9])]),Rd),Ml(Cl([Dl,El([9])]),Rd),Ml(El([27]),function(n,e,t,r){return t.onEscape(n,e)}),Ml(El([32].concat([13])),function(e,t,r,n){return(o=e,i=r,i.focusManager.get(o).bind(function(n){return ci(n,i.selector)})).bind(function(n){return r.execute(e,t,n)});var o,i})]),Ld=W([Ml(El([32]),dd)]),Ud=ud(Ad,pd,jd,Ld,function(){return A.some(Fd)}),Wd=function(n,e,t,i){var u=function(n,e,t){var r,o=Nl(e,i,0,t.length-1);return o===n?A.none():(r=t[o],"button"===pe(r)&&"disabled"===Se(r,"disabled")?u(n,o,t):A.from(t[o]))};return kd(n,t,e).bind(function(n){var e=n.index(),t=n.candidates();return u(e,e,t)})},zd=[vr("selector"),xr("getInitial",A.none),xr("execute",ld),Fu("onEscape"),xr("executeOnMove",!1),xr("allowVertical",!0)],Gd=function(e,t,r){return(n=e,o=r,o.focusManager.get(n).bind(function(n){return ci(n,o.selector)})).bind(function(n){return r.execute(e,t,n)});var n,o},qd=function(e,t){t.getInitial(e).orThunk(function(){return ai(e.element(),t.selector)}).each(function(n){t.focusManager.set(e,n)})},Yd=function(n,e,t){return Wd(n,t.selector,e,-1)},Kd=function(n,e,t){return Wd(n,t.selector,e,1)},Xd=function(r){return function(n,e,t){return r(n,e,t).bind(function(){return t.executeOnMove?Gd(n,e,t):A.some(!0)})}},Qd=function(n,e,t,r){return t.onEscape(n,e)},$d=W([Ml(El([32]),dd)]),Jd=ud(zd,Er.init,function(n,e,t,r){var o=[37].concat(t.allowVertical?[38]:[]),i=[39].concat(t.allowVertical?[40]:[]);return[Ml(El(o),Xd(yd(Yd,Kd))),Ml(El(i),Xd(wd(Yd,Kd))),Ml(El([13]),Gd),Ml(El([32]),Gd),Ml(El([27]),Qd)]},$d,function(){return A.some(qd)}),Zd=vn(["rowIndex","columnIndex","cell"],[]),nm=function(n,e,t){return A.from(n[e]).bind(function(n){return A.from(n[t]).map(function(n){return Zd({rowIndex:e,columnIndex:t,cell:n})})})},em=function(n,e,t,r){var o=n[e].length,i=Nl(t,r,0,o-1);return nm(n,e,i)},tm=function(n,e,t,r){var o=Nl(t,r,0,n.length-1),i=n[o].length,u=Al(e,0,i-1);return nm(n,o,u)},rm=function(n,e,t,r){var o=n[e].length,i=Al(t+r,0,o-1);return nm(n,e,i)},om=function(n,e,t,r){var o=Al(t+r,0,n.length-1),i=n[o].length,u=Al(e,0,i-1);return nm(n,o,u)},im=[hr("selectors",[vr("row"),vr("cell")]),xr("cycles",!0),xr("previousSelector",A.none),xr("execute",ld)],um=function(e,t){t.previousSelector(e).orThunk(function(){var n=t.selectors;return ai(e.element(),n.cell)}).each(function(n){t.focusManager.set(e,n)})},am=function(n,e){return function(t,r,i){var u=i.cycles?n:e;return ci(r,i.selectors.row).bind(function(n){var e=Qe(n,i.selectors.cell);return Td(e,r).bind(function(r){var o=Qe(t,i.selectors.row);return Td(o,n).bind(function(n){var e,t=(e=i,L(o,function(n){return Qe(n,e.selectors.cell)}));return u(t,n,r).map(function(n){return n.cell()})})})})}},cm=am(function(n,e,t){return em(n,e,t,-1)},function(n,e,t){return rm(n,e,t,-1)}),sm=am(function(n,e,t){return em(n,e,t,1)},function(n,e,t){return rm(n,e,t,1)}),fm=am(function(n,e,t){return tm(n,t,e,-1)},function(n,e,t){return om(n,t,e,-1)}),lm=am(function(n,e,t){return tm(n,t,e,1)},function(n,e,t){return om(n,t,e,1)}),dm=W([Ml(El([37]),yd(cm,sm)),Ml(El([39]),wd(cm,sm)),Ml(El([38]),_d(fm)),Ml(El([40]),Sd(lm)),Ml(El([32].concat([13])),function(e,t,r){return Lo(e.element()).bind(function(n){return r.execute(e,t,n)})})]),mm=W([Ml(El([32]),dd)]),gm=ud(im,Er.init,dm,mm,function(){return A.some(um)}),vm=[vr("selector"),xr("execute",ld),xr("moveOnTab",!1)],pm=function(e,t,r){return r.focusManager.get(e).bind(function(n){return r.execute(e,t,n)})},hm=function(e,t){ai(e.element(),t.selector).each(function(n){t.focusManager.set(e,n)})},bm=function(n,e,t){return Wd(n,t.selector,e,-1)},ym=function(n,e,t){return Wd(n,t.selector,e,1)},wm=W([Ml(El([38]),Ed(bm)),Ml(El([40]),Ed(ym)),Ml(Cl([kl,El([9])]),function(n,e,t){return t.moveOnTab?Ed(bm)(n,e,t):A.none()}),Ml(Cl([Dl,El([9])]),function(n,e,t){return t.moveOnTab?Ed(ym)(n,e,t):A.none()}),Ml(El([13]),pm),Ml(El([32]),pm)]),Om=W([Ml(El([32]),dd)]),xm=ud(vm,Er.init,wm,Om,function(){return A.some(hm)}),_m=[Fu("onSpace"),Fu("onEnter"),Fu("onShiftEnter"),Fu("onLeft"),Fu("onRight"),Fu("onTab"),Fu("onShiftTab"),Fu("onUp"),Fu("onDown"),Fu("onEscape"),xr("stopSpaceKeyup",!1),br("focusIn")],Sm=ud(_m,Er.init,function(n,e,t){return[Ml(El([32]),t.onSpace),Ml(Cl([Dl,El([13])]),t.onEnter),Ml(Cl([kl,El([13])]),t.onShiftEnter),Ml(Cl([kl,El([9])]),t.onShiftTab),Ml(Cl([Dl,El([9])]),t.onTab),Ml(El([38]),t.onUp),Ml(El([40]),t.onDown),Ml(El([37]),t.onLeft),Ml(El([39]),t.onRight),Ml(El([32]),t.onSpace),Ml(El([27]),t.onEscape)]},function(n,e,t){return t.stopSpaceKeyup?[Ml(El([32]),dd)]:[]},function(n){return n.focusIn}),Em=cd.schema(),Cm=sd.schema(),km=Jd.schema(),Tm=Ud.schema(),Dm=gm.schema(),Mm=vd.schema(),Nm=xm.schema(),Am=Sm.schema(),Fm=(ed=cr("Creating behaviour: "+(ql={branchKey:"mode",branches:Object.freeze({acyclic:Em,cyclic:Cm,flow:km,flatgrid:Tm,matrix:Dm,execution:Mm,menu:Nm,special:Am}),name:"keying",active:{events:function(n,e){return n.handler.toEvents(n,e)}},apis:{focusIn:function(e,t,r){t.sendFocusIn(t).fold(function(){e.getSystem().triggerFocus(e.element(),e.element())},function(n){n(e,t,r)})},setGridSize:function(n,e,t,r,o){xt(t,"setGridSize")?t.setGridSize(r,o):b.console.error("Layout does not support setGridSize")}},state:hd}).name,Ho,ql),Yl=fr(ed.branchKey,ed.branches),Kl=ed.name,Xl=ed.active,Ql=ed.apis,$l=ed.extra,Jl=ed.state,nd=wr(Kl,[yr("config",Zl=Yl)]),Ao(Zl,nd,Kl,Xl,Ql,$l,Jl)),Bm=Sa({name:"Button",factory:function(n){var e=wl(n.action),t=n.dom.tag,r=function(e){return bt(n.dom,"attributes").bind(function(n){return bt(n,e)})};return{uid:n.uid,dom:n.dom,components:n.components,events:e,behaviours:Eu(n.buttonBehaviours,[Bf.config({}),Fm.config({mode:"execution",useSpace:!0,useEnter:!0})]),domModification:{attributes:function(){if("button"!==t)return{role:r("role").getOr("button")};var n=r("type").getOr("button"),e=r("role").map(function(n){return{role:n}}).getOr({});return Ne({type:n},e)}()},eventOrder:n.eventOrder}},configFields:[xr("uid",void 0),vr("dom"),xr("components",[]),Su("buttonBehaviours",[Bf,Fm]),br("action"),br("role"),xr("eventOrder",{})]}),Rm=["input","button","textarea","select"],Hm=function(n,e,t){e.disabled&&Um(n,e)},Im=function(n){return V(Rm,pe(n.element()))},Pm=function(n){xe(n.element(),"disabled","disabled")},Vm=function(n){Ce(n.element(),"disabled")},jm=function(n){xe(n.element(),"aria-disabled","true")},Lm=function(n){xe(n.element(),"aria-disabled","false")},Um=function(e,n,t){n.disableClass.each(function(n){qe(e.element(),n)}),(Im(e)?Pm:jm)(e),n.onDisabled(e)},Wm=function(e,n,t){n.disableClass.each(function(n){Ke(e.element(),n)}),(Im(e)?Vm:Lm)(e),n.onEnabled(e)},zm=function(n){return Im(n)?Ee(n.element(),"disabled"):"true"===Se(n.element(),"aria-disabled")},Gm=Object.freeze({enable:Wm,disable:Um,isDisabled:zm,onLoad:Hm,set:function(n,e,t,r){(r?Um:Wm)(n,e,t)}}),qm=Object.freeze({exhibit:function(n,e,t){return To({classes:e.disabled?e.disableClass.map(tn).getOr([]):[]})},events:function(n,e){return bo([(t=Gr(),r=function(n,e){return zm(n)},{key:t,value:Tr({abort:r})}),Do(n,e,Hm)]);var t,r}}),Ym=[xr("disabled",!1),br("disableClass"),Au("onDisabled"),Au("onEnabled")],Km=Ro({fields:Ym,name:"disabling",active:qm,apis:Gm}),Xm=Object.freeze({events:function(a){return bo([yo(zr(),function(o,i){var n,e,u=a.channels,t=un(u),r=(n=t,(e=i).universal()?n:z(n,function(n){return V(e.channels(),n)}));U(r,function(n){var e=u[n],t=e.schema,r=cr("channel["+n+"] data\nReceiver: "+$o(o.element()),t,i.data());e.onReceive(o,r)})})])}}),Qm=[pr("channels",ir(Ie.value,Xt([Bu("onReceive"),xr("schema",lr())])))],$m=Ro({fields:Qm,name:"receiving",active:Xm}),Jm="comments.readonly",Zm=function(n){return Km.config(n)},ng=function(){var n,e;return $m.config({channels:(n={},n[Jm]={schema:Xt([(e="readonly",pr(e,mr))]),onReceive:function(n,e){Km.set(n,e.readonly)}},n)})},eg=function(n){return[Zm(n),ng()]},tg=Jm,rg="tox-button--naked",og="tox-comment",ig="tox-comment__body",ug="tox-textarea",ag="tox-comment__reply",cg="tox-comment__overlay",sg="tox-comment__overlaytext",fg="tox-comment__buttonspacing",lg="tox-button",dg="tox-comment__edit",mg="tox-comment__scroll",gg="tox-collection__item",vg="tox-conversations",pg="tox-comment__expander",hg=pg+" p:contains("+al.tc_comment_buttons_showmore+")",bg=pg+" p:contains("+al.tc_comment_buttons_showless+")",yg=function(n){return"."+n},wg=function(e){return function(n){return[yg(og)+":contains("+n+")",yg(e)].join(" ")}},Og={selectors:{kebab:yg(rg),cardBody:yg(og)+" "+yg(ig),card:yg(og),showMore:yg(hg),showLess:yg(bg),editItem:[".tox-menu",'[role="menuitem"]:contains('+al.tc_kebab_edit+")"].join(" "),deleteItem:[".tox-menu",'[role="menuitem"]:contains('+al.tc_kebab_delete+")"].join(" "),outerScroll:yg(mg),outerContainer:yg(vg),cardFor:function(n){return yg(og)+':contains("'+n+'")'},cardN:function(n){return yg(og)+":nth-child("+(n+1)+")"},kebabFor:wg(rg),showMoreFor:wg(hg),showLessFor:wg(bg),saveButton:".tox-button:contains("+al.tc_edit_buttons_save+")",cancelButton:".tox-button:contains("+al.tc_edit_buttons_cancel+")",clearButton:".tox-button:contains("+al.tc_reply_buttons_clear+")",deleteButton:".tox-button:contains("+al.tc_delete_buttons_proceed+")",commentText:[yg(vg),yg(mg),yg(og),"textarea"].join(" "),editActions:yg(dg),cardDeleteButtons:yg(fg),cardDeleteOverlay:yg(cg),cardDeleteOverlayText:yg(sg),replyTextarea:"."+ag+" textarea",editTextarea:[yg(og),"textarea"].join(" "),kebabMenu:yg("tox-menu"),textarea:yg(ug)},states:{kebabOpen:rg+"--open",bodyExpanded:"tox-comment__body--expanded",bodyNotAnimating:"tox-comment__body--pending",disappearing:"tox-comment--disappearing",deletingConversation:"tox-comment-thread__overlay",bodyHasGradient:"tox-comment__gradient",editingTextarea:ug},classes:{showMoreLessContainer:[pg],outerContainer:[vg],date:["tox-comment__date"],replySection:[ag],replyTextarea:[ug],textarea:[],editTextarea:[],kebab:[rg,lg,"tox-button--icon"],kebabIcon:["tox-icon"],card:[og],cardHead:["tox-comment__header"],cardHeadMeta:["tox-comment__meta"],cardBody:[ig],cardDelete:[cg],cardDeleteLabel:[sg],cardDeleteButtons:[fg],button:[lg],secondaryButton:[lg,"tox-button--secondary"],editActions:[dg],outerScroll:[mg],commentList:["tox-comment-thread"],avatar:["tox-user__avatar"],username:["tox-user__name"],user:["tox-user"],showMoreLess:[],kebabItem:[gg],kebabItemLabel:["tox-collection__item-label"],kebabDisabledItem:["tox-collection__item--state-disabled"],kebabMenu:["tox-menu","tox-collection","tox-collection--list"],kebabMenuGroup:["tox-collection__group"],roots:{silver:[vg],modern:[vg,"tox"]}},markers:{kebab:{backgroundMenu:"tox-menu--background",selectedMenu:"tox-menu--active",menu:"tox-menu",item:gg,selectedItem:"tox-collection__item--active"}}},xg=function(t){return function(n){var e=n.eventName.map(function(e){return{action:function(n){oo(n,e)}}}).getOr({});return Bm.sketch(Ne({dom:{tag:"button",classes:t,styles:void 0!==n.styles?n.styles:{},innerHtml:n.text}},e,{buttonBehaviours:Fo([Qf.config({})].concat(eg({})))}))}},_g=xg(Og.classes.button),Sg=xg(Og.classes.secondaryButton),Eg={withClasses:xg,primary:_g,secondary:Sg},Cg="tc-save-edit",kg="tc-cancel-edit",Tg=_i("tc-patch-comment-state-event"),Dg=_i("tc-purge-comment-state-event"),Mg=_i("tc-force-patch-state-event");(rd=td||(td={})).None="Prop_None",rd.Collapsed="Prop_Collapsed",rd.Expanded="Prop_Expanded",rd.CollapsedOrNone="Prop_CollapsedOrNone",rd.ExpandOrNone="Prop_ExpandOrNone",rd.Edit="Prop_Edit",(id=od||(od={}))[id.BeforeDelete=0]="BeforeDelete",id[id.QueryingDelete=1]="QueryingDelete",id[id.PostDelete=2]="PostDelete";var Ng,Ag,Fg=function(n){return L(n.conversation,function(n){return n.props})},Bg=function(n,e){return Ne({},n,{targetUid:e})},Rg=function(n,e){return Ne({},n,{queue:n.queue.concat(e)})},Hg=function(n){if(0<n.queue.length){var e=(t=L((r=n).conversation,function(t){return Y(r.queue,function(n){return n.uid===t.uid}).fold(function(){return t},function(n){var e=void 0!==n.patch.content?{mode:td.ExpandOrNone}:{};return{uid:t.uid,props:Ne({},t.props,n.patch,e)}})}),{targetUid:r.targetUid,conversation:t,queue:[]});return A.some({world:e,props:Fg(e)})}return A.none();var r,t},Ig=function(){return{targetUid:A.none(),conversation:[],queue:[]}},Pg=function(t,r){return function(n){var e=r(n);io(n,Tg,{uid:t,patch:e})}},Vg=function(t,r){return function(n){var e=r(n);io(n,Tg,{uid:t,patch:e}),oo(n,Mg)}},jg=function(n){return oo(n,Mg)},Lg=function(n,e){ru(n.element(),"visibility","hidden"),yl.set(n,!1);var t=n.element().dom().clientHeight;return yl.set(n,!0),cu(n.element(),"visibility"),n.element().dom().scrollHeight>t+1?e:td.None},Ug=function(n){yl.off(n),qe(n.element(),Og.states.bodyHasGradient)},Wg=function(n){yl.on(n),Ke(n.element(),Og.states.bodyHasGradient)},zg=function(n){return ae(n.element())},Gg=function(n,e){Yg(n),e.getOpt(n).fold(function(){Ef.append(n,e.asSpec())},function(){})},qg=function(n){Ke(n.element(),Og.states.bodyHasGradient),yl.set(n,!1),Ce(n.element(),"aria-expanded")},Yg=function(n){zg(n).each(function(n){Ce(n,"readonly"),qe(n,Og.states.editingTextarea),Vo(n);var e=n.dom(),t=su(n).length;e.setSelectionRange(t,t)}),n.element().dom().scrollTop=0},Kg=function(n){zg(n).each(function(n){xe(n,"readonly","true"),Ke(n,Og.states.editingTextarea)})},Xg=function(r){var n,e=function(n){return function(e){U(n,function(n){return n(e)})}},t=function(e){zg(e).each(function(n){cu(n,"height"),Yf.setValue(e,r.props.content),e.getSystem().triggerEvent(Ir(),n,{})})},o=function(n){return e=n,t=r.memCommands,Kg(e),void t.getOpt(e).each(function(n){Ef.remove(e,n)});var e,t},i=((n={})[td.None]=e([o,t,qg]),n[td.Expanded]=e([o,t,Wg]),n[td.Collapsed]=e([o,t,Ug]),n[td.ExpandOrNone]=e([o,t,function(n){qe(n.element(),Og.states.bodyNotAnimating);var e=Lg(n,td.Expanded);Pg(r.props.uid,function(){return{mode:e}})(n)}]),n[td.CollapsedOrNone]=e([o,t,function(n){qe(n.element(),Og.states.bodyNotAnimating);var e=Lg(n,td.Collapsed);e===td.Collapsed&&(qe(n.element(),Og.states.bodyHasGradient),yl.off(n)),n.element().dom().offsetWidth,Pg(r.props.uid,function(){return{mode:e}})(n)}]),n[td.Edit]=e([function(n){return e=n,t=r.memCommands,yl.on(e),Ke(e.element(),Og.states.bodyHasGradient),void Gg(e,t);var e,t},t]),n);return bt(i,r.props.mode)},Qg=_i("tc-focus-outer-comment"),$g=_i("tc-start-delete-comment"),Jg=_i("tc-start-delete-conversation"),Zg=_i("tc-commit-delete"),nv=_i("tc-start-edit-comment"),ev=_i("tc-commit-edit-comment"),tv=(_i("tc-cancel-edit-comment"),_i("tc-long-content"),_i("tc-short-content"),_i("tc-toggle-comment")),rv=W([br("data"),xr("inputAttributes",{}),xr("inputStyles",{}),xr("tag","input"),xr("inputClasses",[]),Au("onSetValue"),xr("styles",{}),xr("eventOrder",{}),Ou("inputBehaviours",[Yf,Bf]),xr("selectOnFocus",!0)]),ov=function(n){return Ne({},(e=n,Fo([Bf.config({onFocus:!1===e.selectOnFocus?y:function(n){var e=n.element(),t=su(e);e.dom().setSelectionRange(0,t.length)}})])),_u(n.inputBehaviours,[Yf.config({store:{mode:"manual",initialValue:n.data.getOr(void 0),getValue:function(n){return su(n.element())},setValue:function(n,e){su(n.element())!==e&&fu(n.element(),e)}},onSetValue:n.onSetValue})]));var e},iv=Sa({name:"Input",configFields:rv(),factory:function(n,e){return{uid:n.uid,dom:(t=n,{tag:t.tag,attributes:Ne({type:"text"},t.inputAttributes),styles:t.inputStyles,classes:t.inputClasses}),components:[],behaviours:ov(n),eventOrder:n.eventOrder};var t}}),uv="data-alloy-widget-tabstop",av=function(n){return Fm.config({mode:"cyclic",onEscape:n.onEscape,useTabstopAt:function(n){return"textarea"!==pe(n)||"true"!==Se(n,"readonly")}})},cv=function(e){return Fm.config({mode:"special",onEnter:function(n){return oo(n,e.enterEvent),A.some(!0)},onShiftEnter:function(n,e){return e.cut(),A.none()},onSpace:function(n,e){return e.cut(),A.none()}})},sv=function(t){return Fm.config({mode:"cyclic",selector:"["+uv+'="true"]',focusInside:fs.OnEnterOrSpaceMode,onEscape:function(n,e){return kr(n,e)?A.none():(oo(n,t.escapeEvent),A.some(!0))}})},fv=function(n){return Fm.config({mode:"flow",allowVertical:!0,selector:n.selector})},lv=uv,dv={"data-gramm_editor":"false",rows:"2"},mv={"white-space":"pre-wrap"},gv=function(n){var e=n.element().dom().clientHeight,t=n.element().dom().scrollHeight;e<t&&ru(n.element(),"height",t+"px")},vv=function(n,e){var t,r,o=le(n),i=function(n){oo(n,Qg),Vg(o.get().uid,function(n){return{mode:td.ExpandOrNone}})(n)},u={updateWith:function(e,n,t){o.set(n),Xg({props:n,memCommands:a}).each(function(n){Ke(e.element(),Og.states.bodyNotAnimating),n(e)})}},a=Ba((o.get(),t=e,{dom:{tag:"div",classes:Og.classes.editActions},components:[Eg.withClasses(Og.classes.secondaryButton)({text:t.translate(al.tc_edit_buttons_cancel),eventName:A.some(kg)}),Eg.withClasses(Og.classes.button)({text:t.translate(al.tc_edit_buttons_save),eventName:A.some(Cg)})]}));return{dom:{tag:"div",classes:Og.classes.cardBody},components:[(r=o.get().content,iv.sketch({tag:"textarea",inputAttributes:Ne({},dv,{readonly:"true"}),inputClasses:Og.classes.editTextarea,inputStyles:Ne({},mv,{"overflow-y":"hidden",border:"none !important"}),data:r,inputBehaviours:Fo([Po("textarea-events",[xo(function(n){gv(n)}),yo(Ir(),gv)]),cv({enterEvent:ev}),Qf.config({})].concat(eg({})))}))],behaviours:Fo([Po("overflow-events",[xo(function(n){u.updateWith(n,o.get(),{})}),yo(Cg,function(n){oo(n,ev)}),yo(kg,i)]),av({onEscape:function(n,e){return i(n),A.some(!0)}}),yl.config({toggleClass:Og.states.bodyExpanded,selected:!1,toggleOnExecute:!1,aria:{mode:"expanded"}}),Yf.config({store:{mode:"manual",getValue:function(n){return ae(n.element()).map(su).getOr("")},setValue:function(n,e){ae(n.element()).each(function(n){fu(n,e)})}}}),Ef.config({})]),apis:u}},pv=6048e5,hv=4*pv;(Ag=Ng||(Ng={}))[Ag.LessThanMinute=0]="LessThanMinute",Ag[Ag.Minute=1]="Minute",Ag[Ag.Hour=2]="Hour",Ag[Ag.Day=3]="Day",Ag[Ag.Week=4]="Week",Ag[Ag.Month=5]="Month",Ag[Ag.Year=6]="Year";var bv,yv,wv,Ov=function(n,e){var t=n()-Date.parse(e);return t<6e4?{interval:Ng.LessThanMinute,intervalUnits:t,intervalMs:t}:t<36e5?{interval:Ng.Minute,intervalUnits:Math.floor(t/6e4),intervalMs:t}:t<864e5?{interval:Ng.Hour,intervalUnits:Math.floor(t/36e5),intervalMs:t}:t<pv?{interval:Ng.Day,intervalUnits:Math.floor(t/864e5),intervalMs:t}:t<hv?{interval:Ng.Week,intervalUnits:Math.floor(t/pv),intervalMs:t}:t<290304e5?{interval:Ng.Month,intervalUnits:Math.floor(t/hv),intervalMs:t}:{interval:Ng.Year,intervalUnits:Math.floor(t/290304e5),intervalMs:t}},xv={nowISO8601:function(){return(new Date).toISOString()},distanceFromNow:l(Ov,function(){return Date.now()}),distanceFrom:Ov},_v=((bv={})[Ng.LessThanMinute]=[al.tc_date_less_than_a_minute_ago,al.tc_date_less_than_a_minute_ago],bv[Ng.Minute]=[al.tc_date_1_minute_ago,al.tc_date_x_minutes_ago],bv[Ng.Hour]=[al.tc_date_1_hour_ago,al.tc_date_x_hours_ago],bv[Ng.Day]=[al.tc_date_1_day_ago,al.tc_date_x_days_ago],bv[Ng.Week]=[al.tc_date_1_week_ago,al.tc_date_x_weeks_ago],bv[Ng.Month]=[al.tc_date_1_month_ago,al.tc_date_x_months_ago],bv[Ng.Year]=[al.tc_date_1_year_ago,al.tc_date_x_years_ago],bv),Sv=function(n,a){var r=function(n){return[(e=""+(r=xv.distanceFromNow(n.createdAt),o=a,i=_v[r.interval],u=1===r.intervalUnits?i[0]:i[1],o.translate([u,r.intervalUnits])),t=x.fromText(e),hu({element:t})),{dom:{tag:"span",classes:[],innerHtml:n.modifiedAt===n.createdAt?"":a.translate(al.tc_date_comment_edited)}}];var e,t,r,o,i,u},e={updateWith:function(n,e,t){Ef.set(n,r(e))}};return{dom:{tag:"div",classes:Og.classes.date},components:r(n),behaviours:Fo([Ef.config({})]),apis:e}},Ev={editCommentEvent:_i("tc-conversation-edit-comment"),deleteCommentEvent:_i("tc-conversation-delete-comment"),deleteConversationEvent:_i("tc-conversation-delete-all"),createCommentEvent:_i("tc-conversation-create")},Cv=function(n){var e,t,r,o=x.fromHtml(n),i=ie(o),u=(t=void 0!==(e=o).dom().attributes?e.dom().attributes:[],q(t,function(n,e){var t;return"class"===e.name?n:Ne({},n,((t={})[e.name]=e.value,t))},{})),a=(r=o,Array.prototype.slice.call(r.dom().classList,0)),c=0===i.length?{}:{innerHtml:Yo(o)};return Ne({tag:pe(o),classes:a,attributes:u},c)},kv=[Qf.config({}),Po("overlay-button-events",[yo(Fr(),function(n,e){e.event().prevent()})])],Tv=function(n,e,t){t?(cu(e.element(),"display"),e.hasConfigured(Fm)&&Fm.focusIn(e)):ru(e.element(),"display","none")},Dv=function(e,n){return(t=n,vo(t,function(n){if(!be(n))return!1;var e=Se(n,"id");return void 0!==e&&-1<e.indexOf("aria-owns")}).bind(function(n){var e=Se(n,"id"),t=te(n);return ai(t,'[aria-owns="'+e+'"]')})).exists(function(n){return Mv(e,n)});var t},Mv=function(e,n){return t=n,o=W(!(r=function(n){return ee(n,e.element())})),vo(t,r,o).isSome()||Dv(e,n);var t,r,o},Nv=Object.freeze({getCoupled:function(n,e,t,r){return t.getOrCreate(n,e,r)}}),Av=[pr("others",ir(Ie.value,lr()))],Fv=Ro({fields:Av,name:"coupling",apis:Nv,state:Object.freeze({init:function(n){var i={},e=W({});return Cr({readState:e,getOrCreate:function(t,r,o){var n=un(r.others);if(n)return bt(i,o).getOrThunk(function(){var n=bt(r.others,o).getOrDie("No information found for coupled component: "+o)(t),e=t.getSystem().build(n);return i[o]=e});throw new Error("Cannot find coupled component: "+o+". Known coupled components: "+Lt(n,null,2))}})}})}),Bv=function(n,e,t,r){var o=function(e,n,t,r){t.get().each(function(n){Aa(e)});var o=n.getAttachPoint(e);Ta(o,e);var i=e.getSystem().build(r);return Ta(e,i),t.set(i),i}(n,e,t,r);return e.onOpen(n,o),o},Rv=function(e,t,r){r.get().each(function(n){Aa(e),Na(e),t.onClose(e,n),r.clear()})},Hv=function(n,e,t){return t.isOpen()},Iv=function(n,e,t){var r,o,i,u,a=e.getAttachPoint(n);ru(n.element(),"position",wf.getMode(a)),r=n,o="visibility",i=e.cloakVisibilityAttr,u="hidden",au(r.element(),o).fold(function(){Ce(r.element(),i)},function(n){xe(r.element(),i,n)}),ru(r.element(),o,u)},Pv=function(n,e,t){var r;r=n.element(),j(["top","left","right","bottom"],function(n){return au(r,n).isSome()})||cu(n.element(),"position"),function(n,e,t){if(Ee(n.element(),t)){var r=Se(n.element(),t);ru(n.element(),e,r)}else cu(n.element(),e)}(n,"visibility",e.cloakVisibilityAttr)},Vv=Object.freeze({cloak:Iv,decloak:Pv,open:Bv,openWhileCloaked:function(n,e,t,r,o){Iv(n,e),Bv(n,e,t,r),o(),Pv(n,e)},close:Rv,isOpen:Hv,isPartOf:function(e,t,n,r){return Hv(0,0,n)&&n.get().exists(function(n){return t.isPartOf(e,n,r)})},getState:function(n,e,t){return t.get()}}),jv=Object.freeze({events:function(t,r){return bo([yo(Qr(),function(n,e){Rv(n,t,r)})])}}),Lv=[Au("onOpen"),Au("onClose"),vr("isPartOf"),vr("getAttachPoint"),xr("cloakVisibilityAttr","data-precloak-visibility")],Uv=Ro({fields:Lv,name:"sandboxing",active:jv,apis:Vv,state:Object.freeze({init:function(){var e=le(A.none()),n=W("not-implemented");return Cr({readState:n,isOpen:function(){return e.get().isSome()},clear:function(){e.set(A.none())},set:function(n){e.set(A.some(n))},get:function(n){return e.get()}})}})}),Wv="alloy.item-hover",zv="alloy.item-focus",Gv=function(n){(Lo(n.element()).isNone()||Bf.isFocused(n))&&(Bf.isFocused(n)||Bf.focus(n),io(n,Wv,{item:n}))},qv=function(n){io(n,zv,{item:n})},Yv=W(Wv),Kv=W(zv),Xv=[vr("data"),vr("components"),vr("dom"),xr("hasSubmenu",!1),br("toggling"),Su("itemBehaviours",[yl,Bf,Fm,Yf]),xr("ignoreFocus",!1),xr("domModification",{}),Hu("builder",function(n){return{dom:n.dom,domModification:Ne({},n.domModification,{attributes:Ne({role:n.toggling.isSome()?"menuitemcheckbox":"menuitem"},n.domModification.attributes,{"aria-haspopup":n.hasSubmenu},n.hasSubmenu?{"aria-expanded":!1}:{})}),behaviours:Eu(n.itemBehaviours,[n.toggling.fold(yl.revoke,function(n){return yl.config(Ne({aria:{mode:"checked"}},n))}),Bf.config({ignore:n.ignoreFocus,stopMousedown:n.ignoreFocus,onFocus:function(n){qv(n)}}),Fm.config({mode:"execution"}),Yf.config({store:{mode:"memory",initialValue:n.data}}),Po("item-type-events",[yo(Kr(),uo),Oo(Fr()),yo(Br(),Gv),yo(qr(),Bf.focus)])]),components:n.components,eventOrder:n.eventOrder}}),xr("eventOrder",{})],Qv=[vr("dom"),vr("components"),Hu("builder",function(n){return{dom:n.dom,components:n.components,events:bo([(e=qr(),yo(e,function(n,e){e.stop()}))])};var e})],$v=W([aa({name:"widget",overrides:function(e){return{behaviours:Fo([Yf.config({store:{mode:"manual",getValue:function(n){return e.data},setValue:function(){}}})])}}})]),Jv=[vr("uid"),vr("data"),vr("components"),vr("dom"),xr("autofocus",!1),xr("ignoreFocus",!1),Su("widgetBehaviours",[Yf,Bf,Fm]),xr("domModification",{}),ba($v()),Hu("builder",function(i){var n=va(0,i,$v()),e=pa("item-widget",i,n.internals()),t=function(n){return(e=n,t=i,r="widget",o=t.partUids[r],e.getSystem().getByUid(o).toOption()).map(function(n){return Fm.focusIn(n),n});var e,t,r,o},r=function(n,e){return fd(e.event().target())||i.autofocus&&e.setSource(n.element()),A.none()};return{dom:i.dom,components:e,domModification:i.domModification,events:bo([Eo(function(n,e){t(n).each(function(n){e.stop()})}),yo(Br(),Gv),yo(qr(),function(n,e){i.autofocus?t(n):Bf.focus(n)})]),behaviours:Eu(i.widgetBehaviours,[Yf.config({store:{mode:"memory",initialValue:i.data}}),Bf.config({ignore:i.ignoreFocus,onFocus:function(n){qv(n)}}),Fm.config({mode:"special",focusIn:i.autofocus?function(n){t(n)}:Io(),onLeft:r,onRight:r,onEscape:function(n,e){return Bf.isFocused(n)||i.autofocus?(i.autofocus&&e.setSource(n.element()),A.none()):(Bf.focus(n),A.some(!0))}})])}})],Zv=fr("type",{widget:Jv,item:Xv,separator:Qv}),np=W([fa({factory:{sketch:function(n){var e=cr("menu.spec item",Zv,n);return e.builder(e)}},name:"items",unit:"item",defaults:function(n,e){return e.hasOwnProperty("uid")?e:Ne({},e,{uid:Mi("item")})},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus,domModification:{classes:[n.markers.item]}}}})]),ep=W([vr("value"),vr("items"),vr("dom"),vr("components"),xr("eventOrder",{}),Ou("menuBehaviours",[Wl,Yf,Df,Fm]),_r("movement",{mode:"menu",moveOnTab:!0},fr("mode",{grid:[Pu(),Hu("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers.item,initSize:{numColumns:e.initSize.numColumns,numRows:e.initSize.numRows},focusManager:n.focusManager}})],matrix:[Hu("config",function(n,e){return{mode:"matrix",selectors:{row:e.rowSelector,cell:"."+n.markers.item},focusManager:n.focusManager}}),vr("rowSelector")],menu:[xr("moveOnTab",!0),Hu("config",function(n,e){return{mode:"menu",selector:"."+n.markers.item,moveOnTab:e.moveOnTab,focusManager:n.focusManager}})]})),pr("markers",Tu()),xr("fakeFocus",!1),xr("focusManager",Gl()),Au("onHighlight")]),tp=W("alloy.menu-focus"),rp=Ea({name:"Menu",configFields:ep(),partFields:np(),factory:function(n,e,t,r){return{uid:n.uid,dom:n.dom,markers:n.markers,behaviours:_u(n.menuBehaviours,[Wl.config({highlightClass:n.markers.selectedItem,itemClass:n.markers.item,onHighlight:n.onHighlight}),Yf.config({store:{mode:"memory",initialValue:n.value}}),Df.config({find:A.some}),Fm.config(n.movement.config(n,n.movement))]),events:bo([yo(Kv(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){Wl.highlight(e,n),t.stop(),io(e,tp(),{menu:e,item:n})})}),yo(Yv(),function(n,e){var t=e.event().item();Wl.highlight(n,t)})]),components:e,eventOrder:n.eventOrder,domModification:{attributes:{role:"menu"}}}}}),op=function(t,r,o,n){return bt(o,n).bind(function(n){return bt(t,n).bind(function(n){var e=op(t,r,o,n);return A.some([n].concat(e))})}).getOr([])},ip=function(n,e){var t={};cn(n,function(n,e){U(n,function(n){t[n]=e})});var r=e,o=fn(e,function(n,e){return{k:n,v:e}}),i=sn(o,function(n,e){return[e].concat(op(t,r,o,e))});return sn(t,function(n){return bt(i,n).getOr([n])})},up=function(){var i=le({}),u=le({}),a=le({}),c=le(A.none()),s=le({}),e=function(n){return bt(u.get(),n)};return{setMenuBuilt:function(n,e){var t;u.set(Ne({},u.get(),((t={})[n]={type:"prepared",menu:e},t)))},setContents:function(n,e,t,r){c.set(A.some(n)),i.set(t),u.set(e),s.set(r);var o=ip(r,t);a.set(o)},expand:function(t){return bt(i.get(),t).map(function(n){var e=bt(a.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return bt(a.get(),n)},collapse:function(n){return bt(a.get(),n).bind(function(n){return 1<n.length?A.some(n.slice(1)):A.none()})},lookupMenu:e,otherMenus:function(n){var e=s.get();return en(un(e),n)},getPrimary:function(){return c.get().bind(function(n){return e(n).bind(function(n){return"prepared"===n.type?A.some(n.menu):A.none()})})},getMenus:function(){return u.get()},clear:function(){i.set({}),u.set({}),a.set({}),c.set(A.none())},isClear:function(){return c.get().isNone()}}},ap=W("collapse-item"),cp=Sa({name:"TieredMenu",configFields:[Ru("onExecute"),Ru("onEscape"),Bu("onOpenMenu"),Bu("onOpenSubmenu"),Au("onCollapseMenu"),xr("highlightImmediately",!0),hr("data",[vr("primary"),vr("menus"),vr("expansions")]),xr("fakeFocus",!1),Au("onHighlight"),Au("onHover"),Mu(),vr("dom"),xr("navigateOnHover",!0),xr("stayInDom",!1),Ou("tmenuBehaviours",[Fm,Wl,Df,Ef]),xr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)},highlightPrimary:function(n,e){n.highlightPrimary(e)}},factory:function(a,n){var c,e,i=le(A.none()),u=function(r,o,n){return sn(n,function(n,e){var t=function(){return rp.sketch(Ne({dom:n.dom},n,{value:e,items:n.items,markers:a.markers,fakeFocus:a.fakeFocus,onHighlight:a.onHighlight,focusManager:a.fakeFocus?(o=function(n){return Wl.getHighlighted(n).map(function(n){return n.element()})},{get:o,set:function(e,n){var t=o(e);e.getSystem().getByDom(n).fold(y,function(n){Wl.highlight(e,n)});var r=o(e);zl(e,t,r)}}):Gl()}));var o};return e===o?{type:"prepared",menu:r.getSystem().build(t())}:{type:"notbuilt",nbMenu:t}})},s=up(),f=function(n){return Yf.getValue(n).value},l=function(n){return sn(a.data.menus,function(n,e){return J(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},d=function(e,n){Wl.highlight(e,n),Wl.getHighlighted(n).orThunk(function(){return Wl.getFirst(n)}).each(function(n){ao(e,n.element(),qr())})},m=function(e,n){return Go(L(n,function(n){return e.lookupMenu(n).bind(function(n){return"prepared"===n.type?A.some(n.menu):A.none()})}))},g=function(e,n,t){var r=m(n,n.otherMenus(t));U(r,function(n){Zi(n.element(),[a.markers.backgroundMenu]),a.stayInDom||Ef.remove(e,n)})},v=function(n,r){var o,e=(o=n,i.get().getOrThunk(function(){var t={},n=Qe(o.element(),"."+a.markers.item),e=z(n,function(n){return"true"===Se(n,"aria-haspopup")});return U(e,function(n){o.getSystem().getByDom(n).each(function(n){var e=f(n);t[e]=n})}),i.set(A.some(t)),t}));cn(e,function(n,e){var t=V(r,e);xe(n.element(),"aria-expanded",t)})},p=function(r,o,i){return A.from(i[0]).bind(function(n){return o.lookupMenu(n).bind(function(n){if("notbuilt"===n.type)return A.none();var e=n.menu,t=m(o,i.slice(1));return U(t,function(n){qe(n.element(),a.markers.backgroundMenu)}),ke(e.element())||Ef.append(r,wu(e)),Zi(e.element(),[a.markers.backgroundMenu]),d(r,e),g(r,o,i),A.some(e)})})};(e=c||(c={}))[e.HighlightSubmenu=0]="HighlightSubmenu",e[e.HighlightParent=1]="HighlightParent";var h=function(o,i,u){void 0===u&&(u=c.HighlightSubmenu);var n=f(i);return s.expand(n).bind(function(r){return v(o,r),A.from(r[0]).bind(function(t){return s.lookupMenu(t).bind(function(n){var e=function(n,e,t){if("notbuilt"!==t.type)return t.menu;var r=n.getSystem().build(t.nbMenu());return s.setMenuBuilt(e,r),r}(o,t,n);return ke(e.element())||Ef.append(o,wu(e)),a.onOpenSubmenu(o,i,e),u===c.HighlightSubmenu?(Wl.highlightFirst(e),p(o,s,r)):(Wl.dehighlightAll(e),A.some(i))})})})},r=function(e,t){var n=f(t);return s.collapse(n).bind(function(n){return v(e,n),p(e,s,n).map(function(n){return a.onCollapseMenu(e,t,n),n})})},t=function(t){return function(e,n){return ci(n.getSource(),"."+a.markers.item).bind(function(n){return e.getSystem().getByDom(n).toOption().bind(function(n){return t(e,n).map(function(){return!0})})})}},o=bo([yo(tp(),function(e,n){var t=n.event().menu();Wl.highlight(e,t);var r=f(n.event().item());s.refresh(r).each(function(n){return g(e,s,n)})}),Eo(function(e,n){var t=n.event().target();e.getSystem().getByDom(t).each(function(n){0===f(n).indexOf("collapse-item")&&r(e,n),h(e,n,c.HighlightSubmenu).fold(function(){a.onExecute(e,n)},function(){})})}),xo(function(e,n){var t,r,o;(t=e,r=u(t,a.data.primary,a.data.menus),o=l(),s.setContents(a.data.primary,r,a.data.expansions,o),s.getPrimary()).each(function(n){Ef.append(e,wu(n)),a.onOpenMenu(e,n),a.highlightImmediately&&d(e,n)})})].concat(a.navigateOnHover?[yo(Yv(),function(n,e){var t,r,o=e.event().item();t=n,r=f(o),s.refresh(r).bind(function(n){return v(t,n),p(t,s,n)}),h(n,o,c.HighlightParent),a.onHover(n,o)})]:[])),b={collapseMenu:function(e){Wl.getHighlighted(e).each(function(n){Wl.getHighlighted(n).each(function(n){r(e,n)})})},highlightPrimary:function(e){s.getPrimary().each(function(n){d(e,n)})}};return{uid:a.uid,dom:a.dom,markers:a.markers,behaviours:_u(a.tmenuBehaviours,[Fm.config({mode:"special",onRight:t(function(n,e){return fd(e.element())?A.none():h(n,e,c.HighlightSubmenu)}),onLeft:t(function(n,e){return fd(e.element())?A.none():r(n,e)}),onEscape:t(function(n,e){return r(n,e).orThunk(function(){return a.onEscape(n,e).map(function(){return n})})}),focusIn:function(e,n){s.getPrimary().each(function(n){ao(e,n.element(),qr())})}}),Wl.config({highlightClass:a.markers.selectedMenu,itemClass:a.markers.menu}),Df.config({find:function(n){return Wl.getHighlighted(n)}}),Ef.config({})]),eventOrder:a.eventOrder,apis:b,events:o}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:yt(n,e),expansions:{}}},collapseItem:function(n){return{value:_i(ap()),meta:{text:n}}}}}),sp=W("sink"),fp=W(sa({name:sp(),overrides:W({dom:{tag:"div"},behaviours:Fo([wf.config({useFixed:!0})]),events:bo([Oo(Rr()),Oo(Fr()),Oo(Pr())])})})),lp=Xt([xr("isExtraPart",W(!1)),wr("fireEventInstead",[xr("event",no())])]),dp=function(n){var t=cr("Dismissal",lp,n);return{channels:yt(O(),{schema:Xt([vr("target")]),onReceive:function(e,n){Uv.isOpen(e)&&(Uv.isPartOf(e,n.target)||t.isExtraPart(e,n.target)||t.fireEventInstead.fold(function(){return Uv.close(e)},function(n){return oo(e,n.event)}))}})}};(wv=yv||(yv={}))[wv.HighlightFirst=0]="HighlightFirst",wv[wv.HighlightNone=1]="HighlightNone";var mp,gp,vp=function(n,e){var t=n.getHotspot(e).getOr(e),r=n.getAnchorOverrides();return n.layouts.fold(function(){return{anchor:"hotspot",hotspot:t,overrides:r}},function(n){return{anchor:"hotspot",hotspot:t,overrides:r,layouts:n}})},pp=function(n,e,t,r,o,i,u){var a,c,s,f,l,d,m,g,v,p,h=vp(n,t);return(c=h,f=r,l=o,d=u,m=e,g=s=t,v=(0,(a=n).fetch)(g).map(m),p=wp(s,a),v.map(function(n){return n.bind(function(n){return A.from(cp.sketch(Ne({},l.menu(),{uid:Mi(""),data:n,highlightImmediately:d===yv.HighlightFirst,onOpenMenu:function(n,e){var t=p().getOrDie();wf.position(t,c,e),Uv.decloak(f)},onOpenSubmenu:function(n,e,t){var r=p().getOrDie();wf.position(r,{anchor:"submenu",item:e},t),Uv.decloak(f)},onEscape:function(){return Bf.focus(s),Uv.close(f),A.some(!0)}})))})})).map(function(n){return n.fold(function(){Uv.isOpen(r)&&Uv.close(r)},function(n){Uv.cloak(r),Uv.open(r,n),i(r)}),r})},hp=function(n,e,t,r,o,i,u){return Uv.close(r),ve.pure(r)},bp=function(n,e,t,r,o,i){var u=Fv.getCoupled(t,"sandbox");return(Uv.isOpen(u)?hp:pp)(n,e,t,u,r,o,i)},yp=function(n,e,t){var r,o,i,u=Df.getCurrent(e).getOr(e),a=(r=n.element(),za.get(r));t?ru(u.element(),"min-width",a+"px"):(o=u.element(),i=a,za.set(o,i))},wp=function(e,n){return e.getSystem().getByUid(n.uid+"-"+sp()).map(function(n){return function(){return Ie.value(n)}}).getOrThunk(function(){return n.lazySink.fold(function(){return function(){return Ie.error(new Error("No internal sink is specified, nor could an external sink be found"))}},function(n){return function(){return n(e)}})})},Op=function(r,o,i){var e,n,t,u=(e=_i("aria-owns"),{id:W(e),link:function(n){xe(n,"aria-owns",e)},unlink:function(n){Ce(n,"aria-owns")}}),a=wp(o,r);return{dom:{tag:"div",classes:r.sandboxClasses,attributes:{id:u.id(),role:"listbox"}},behaviours:Eu(r.sandboxBehaviours,[Yf.config({store:{mode:"memory",initialValue:o}}),Uv.config({onOpen:function(n,e){var t=vp(r,o);u.link(o.element()),r.matchWidth&&yp(t.hotspot,e,r.useMinWidth),r.onOpen(t,n,e),void 0!==i&&void 0!==i.onOpen&&i.onOpen(n,e)},onClose:function(n,e){u.unlink(o.element()),void 0!==i&&void 0!==i.onClose&&i.onClose(n,e)},isPartOf:function(n,e,t){return Mv(e,t)||Mv(o,t)},getAttachPoint:function(){return a().getOrDie()}}),Df.config({find:function(n){return Uv.getState(n).bind(function(n){return Df.getCurrent(n)})}}),(n={isExtraPart:W(!1)},t=dp(n),$m.config(t))])}},xp=W([vr("dom"),vr("fetch"),Au("onOpen"),Fu("onExecute"),xr("getHotspot",A.some),xr("getAnchorOverrides",W({})),xr("layouts",A.none()),Ou("dropdownBehaviours",[yl,Fv,Fm,Bf]),vr("toggleClass"),xr("eventOrder",{}),br("lazySink"),xr("matchWidth",!1),xr("useMinWidth",!1),br("role")].concat([xr("sandboxClasses",[]),Su("sandboxBehaviours",[Df,$m,Uv,Yf])])),_p=W([ca({schema:[Mu()],name:"menu",defaults:function(n){return{onExecute:n.onExecute}}}),fp()]),Sp=Ea({name:"Dropdown",configFields:xp(),partFields:_p(),factory:function(e,n,t,r){var o,i,u=function(n){Uv.getState(n).each(function(n){cp.highlightPrimary(n)})},a={expand:function(n){yl.isOn(n)||bp(e,function(n){return n},n,r,y,yv.HighlightNone).get(y)},open:function(n){yl.isOn(n)||bp(e,function(n){return n},n,r,y,yv.HighlightFirst).get(y)},isOpen:yl.isOn,close:function(n){yl.isOn(n)&&bp(e,function(n){return n},n,r,y,yv.HighlightFirst).get(y)}},c=function(n,e){return uo(n),A.some(!0)};return{uid:e.uid,dom:e.dom,components:n,behaviours:_u(e.dropdownBehaviours,[yl.config({toggleClass:e.toggleClass,aria:{mode:"expanded"}}),Fv.config({others:{sandbox:function(n){return Op(e,n,{onOpen:function(){yl.on(n)},onClose:function(){yl.off(n)}})}}}),Fm.config({mode:"special",onSpace:c,onEnter:c,onDown:function(n,e){if(Sp.isOpen(n)){var t=Fv.getCoupled(n,"sandbox");u(t)}else Sp.open(n);return A.some(!0)},onEscape:function(n,e){return Sp.isOpen(n)?(Sp.close(n),A.some(!0)):A.none()}}),Bf.config({})]),events:wl(A.some(function(n){bp(e,function(n){return n},n,r,u,yv.HighlightFirst).get(y)})),eventOrder:Ne({},e.eventOrder,(o={},o[Gr()]=["disabling","toggling","alloy.base.behaviour"],o)),apis:a,domModification:{attributes:Ne({"aria-haspopup":"true"},e.role.fold(function(){return{}},function(n){return{role:n}}),"button"===e.dom.tag?{type:(i="type",bt(e.dom,"attributes").bind(function(n){return bt(n,i)})).getOr("button")}:{})}}},apis:{open:function(n,e){return n.open(e)},expand:function(n,e){return n.expand(e)},close:function(n,e){return n.close(e)},isOpen:function(n,e){return n.isOpen(e)}}}),Ep=_i("tc-kebab-action"),Cp="basecamp",kp="deleting",Tp={textKey:al.tc_kebab_edit,eventName:nv},Dp={textKey:al.tc_kebab_delete,eventName:$g},Mp={textKey:al.tc_kebab_deleteconversation,eventName:Jg},Np=function(n,a,e,t,r){var o,i;void 0===e&&(e='<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 24C5.373 24 0 18.627 0 12S5.373 0 12 0s12 5.373 12 12-5.373 12-12 12zm-8.693-5.259A10.981 10.981 0 0 0 12 23c3.535 0 6.68-1.668 8.693-4.259C19.432 16.251 14.591 15 12 15c-2.59 0-7.432 1.25-8.693 3.741zm8.7-5.741C14.224 13 16 10.99 16 8.5S14.224 4 12.007 4C9.79 4 8 6.01 8 8.5S9.79 13 12.007 13z" fill-rule="nonzero"></path></svg>');var u,c,s,f,l,d,m,g,v,p,h,b,y,w,O,x,_=le(n),S=$([t.deleteConversation?[Mp]:[],t.editComment?[Tp]:[],t.deleteComment?[Dp]:[]]),E=Ba(Sv(n,r.universe)),C={updateWith:function(n,e,t){var r,o,i,u;_.set(e),T.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),D.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})}),r=n,o=t.numComments,i=e.isDeleting===od.QueryingDelete,u=a,M.getOpt(r).each(function(n){return Tv(0,n,i)}),N.getOpt(r).each(function(n){var e=u?[al.tc_delete_prompts_conversation,1===o?al.tc_delete_prompts_conversation_detail_sing:{pattern:al.tc_delete_prompts_conversation_detail_pl,targets:[o]}]:[al.tc_delete_prompts_comment];n.getApis().setText(n,e),Tv(0,n,i)}),e.isDeleting===od.PostDelete&&il.getCurrentRoute(n).filter(function(n){return n.destination===kp}).fold(function(){il.progressTo(n,kp)},function(n){}),E.getOpt(n).each(function(n){n.getApis().updateWith(n,e,{})})}},k={dom:{tag:"div",classes:Og.classes.cardHead},components:$([[{dom:{tag:"div",classes:Og.classes.cardHeadMeta},components:[(f=_.get().authorName,l=e,d={dom:{tag:"div",classes:Og.classes.avatar,innerHtml:l}},m={dom:{tag:"div",classes:Og.classes.username,innerHtml:f}},{dom:{tag:"div",classes:Og.classes.user},components:[d,{dom:{tag:"div"},components:[m,E.asSpec()]}]})]}],0<S.length?[(u=S,c=r,s=L(u,function(e){var n;return{type:"item",data:{value:e.eventName},dom:{tag:"div",classes:Og.classes.kebabItem},components:[{dom:{tag:"span",classes:Og.classes.kebabItemLabel,innerHtml:c.universe.translate(e.textKey)}}],itemBehaviours:Fo([Po("item-events",[Eo(function(n){io(n,Ep,{eventName:e.eventName}),oo(n,Qr())})])].concat(eg({disableClass:Og.classes.kebabDisabledItem.join(" ")}))),eventOrder:(n={},n[Gr()]=["disabling","alloy.base.behaviour","toggling","typeaheadevents","item-events"],n)}}),Sp.sketch({dom:{tag:"button",attributes:{type:"button"},classes:Og.classes.kebab},components:[{dom:{tag:"div",classes:Og.classes.kebabIcon,innerHtml:'<svg width="24" height="24" data-name="icon-image-options"><g id="icon-image-options" stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z" id="Shape" fill-rule="nonzero"></path></g></svg>'}}],lazySink:function(n){return c.getSink(n).fold(function(){return Ie.error("Could not find sink for kebab")},Ie.value)},dropdownBehaviours:Fo(eg({}).concat([Qf.config({tabAttr:lv})])),sandboxBehaviours:Fo([Po("kebab-sandbox-events",[yo(Ep,function(n,e){var t=Yf.getValue(n);oo(t,e.event().eventName())})])]),parts:{menu:{dom:{tag:"div"},markers:Og.markers.kebab}},toggleClass:Og.states.kebabOpen,layouts:A.some({onLtr:function(){return[vc]},onRtl:function(){return[gc]}}),fetch:function(n){var e=_i("kebab-id");return ve.pure(A.some(cp.singleData(e,{value:_i(e),dom:{tag:"div",classes:Og.classes.kebabMenu},components:[{dom:{tag:"div",classes:Og.classes.kebabMenuGroup},components:[rp.parts().items({})]}],items:s})))}}))]:[]])},T=Ba((g={uid:n.uid,mode:n.mode},v=le(g),p={updateWith:function(n,e,t){switch(v.set(e),e.mode){case td.None:ru(n.element(),"display","none");break;case td.Collapsed:cu(n.element(),"display"),ae(n.element()).each(function(n){return Ko(n,al.tc_comment_buttons_showmore)});break;case td.Expanded:cu(n.element(),"display"),ae(n.element()).each(function(n){return Ko(n,al.tc_comment_buttons_showless)});break;case td.ExpandOrNone:case td.CollapsedOrNone:break;case td.Edit:ru(n.element(),"display","none")}}},{dom:{tag:"div",classes:Og.classes.showMoreLessContainer,styles:{display:"none"}},components:[Bm.sketch({dom:{tag:"p",classes:Og.classes.showMoreLess,innerHtml:al.tc_comment_buttons_showmore},action:function(n){Vg(v.get().uid,function(n){return{mode:v.get().mode===td.Collapsed?td.Expanded:td.Collapsed}})(n)},buttonBehaviours:Fo([Qf.config({tabAttr:lv})])})],apis:p})),D=Ba(vv(_.get(),r.universe)),M=Ba((r.universe,{dom:{tag:"div",classes:Og.classes.cardDelete,styles:{display:"none"}}})),N=Ba((h=function(){return _.get().uid},b=r.universe,y=function(n){oo(n,Qg),Vg(h(),function(n){return{isDeleting:od.BeforeDelete}})(n)},w=function(n,e,t){var r;return Bm.sketch({dom:{tag:"button",classes:n?Og.classes.button:Og.classes.secondaryButton,innerHtml:e},eventOrder:(r={},r[Fr()]=["alloy.base.behaviour","focusing","overlay-button-events"],r),action:t,buttonBehaviours:Fo(kv)})},O={setText:function(n,e){Ef.set(n,L(e,function(n){var e="string"==typeof n?b.translate(n):b.translate([n.pattern].concat(n.targets));return{dom:{tag:"div"},components:[{dom:Cv("<p>"+e+"</p>")}]}}).concat([x.asSpec()]))}},x=Ba({dom:{tag:"div",classes:Og.classes.cardDeleteButtons},components:[w(!0,b.translate(al.tc_delete_buttons_cancel),y),w(!1,b.translate(al.tc_delete_buttons_proceed),function(n){oo(n,Zg)})]}),{dom:{tag:"div",styles:{display:"none"},classes:Og.classes.cardDeleteLabel},components:[],apis:O,behaviours:Fo([Ef.config({}),Po("card-delete-events",[yo(Ur(),function(n){Lo(n.element()).fold(function(){Vg(h(),function(n){return{isDeleting:od.BeforeDelete}})(n)},function(){})})]),Fm.config({mode:"cyclic",onEscape:function(n){return y(n),A.some(!0)}})])}));return{dom:{tag:"div",classes:Og.classes.card,styles:{position:"relative"}},components:[k,D.asSpec(),M.asSpec(),N.asSpec(),T.asSpec()],behaviours:Fo([Bf.config({}),Qf.config({}),sv({escapeEvent:Qg}),il.config({initialState:Cp,onTransition:function(n,e){var t;t=_.get().uid,io(n,Dg,{uid:t})},routes:(o={},o[Cp]=(i={},i[kp]={transition:{property:"opacity",transitionClass:Og.states.disappearing}},i),o)}),Yf.config({store:{mode:"memory",initialValue:_.get().uid}}),Po("comment-events",[yo(tv,function(n){return Vg(_.get().uid,function(){return{mode:_.get().mode===td.Collapsed?td.Expanded:td.Collapsed}})(n)}),yo(Qg,Bf.focus),yo($g,function(n,e){Vg(_.get().uid,function(n){return{isDeleting:od.QueryingDelete}})(n)}),yo(Jg,function(n,e){Vg(_.get().uid,function(n){return{isDeleting:od.QueryingDelete}})(n)}),yo(nv,function(n){return Vg(_.get().uid,function(n){return{mode:td.Edit}})(n)}),yo(ev,function(t){D.getOpt(t).each(function(n){var e=Yf.getValue(n);io(t,Ev.editCommentEvent,{uid:_.get().uid,content:e})})}),yo(Zg,function(n,e){io(n,a?Ev.deleteConversationEvent:Ev.deleteCommentEvent,{uid:_.get().uid})})])]),apis:C}},Ap=function(n,r){return L(n,function(n,e){var t=0===e;return Np(n,t,void 0,{editComment:!0,deleteComment:0<e,deleteConversation:t},r)})},Fp=function(n,o){var e={setComments:function(n,e){Df.getCurrent(n).each(function(n){Ef.set(n,Ap(e,o))}),jg(n)},updateWith:function(e,r,n){Df.getCurrent(e).each(function(n){var t=Ef.contents(n);rn(r).exists(function(n){return n.isDeleting===od.QueryingDelete})?qe(n.element(),Og.states.deletingConversation):Ke(n.element(),Og.states.deletingConversation),t.length!==r.length?Ef.set(n,Ap(r,o)):U(t,function(n,e){t[e].getApis().updateWith(t[e],r[e],{numComments:r.length})}),jg(e)})},scrollToEnd:function(i){Df.getCurrent(i).each(function(n){var e,t=Ef.contents(n);(e=t,0===e.length?A.none():A.some(e[e.length-1])).each(function(n){var e,t,r,o;e=n.element(),t=i.element(),r=t.dom().getBoundingClientRect(),(o=e.dom().getBoundingClientRect()).top<r.top?Cc(e,!0):o.bottom>r.bottom&&Cc(e,!1)})})}};return{dom:{tag:"div",classes:Og.classes.outerScroll},components:[{dom:{tag:"div",classes:Og.classes.commentList},components:Ap(n,o),behaviours:Fo([fv({selector:Og.selectors.card}),Ef.config({})])}],behaviours:Fo([Df.config({find:function(e){return ae(e.element()).bind(function(n){return e.getSystem().getByDom(n).toOption()})}})]),apis:e}};(gp=mp||(mp={}))[gp.Start=0]="Start",gp[gp.Reply=1]="Reply";var Bp=_i("tc-clear-input"),Rp=_i("tc-submit-input"),Hp=function(n){return e=Rp,t=n,iv.sketch({tag:"textarea",inputClasses:Og.classes.replyTextarea,inputAttributes:Ne({},dv,{placeholder:t.translate(al.tc_reply_placeholders)}),inputStyles:mv,inputBehaviours:Fo([cv({enterEvent:e}),Qf.config({}),Po("reply-events",[yo(Ir(),gv)])].concat(eg({})))});var e,t},Ip=function(t,n){var r=Ba(Hp(n)),e={focusEditor:function(n){r.getOpt(n).each(Bf.focus)},updateWith:function(n,e,t){j(e,function(n){return n.mode===td.Edit})?ru(n.element(),"display","none"):cu(n.element(),"display")}};return{dom:{tag:"div",classes:Og.classes.replySection},behaviours:Fo([Po("reply-events",[yo(Bp,function(n){r.getOpt(n).each(function(n){Yf.setValue(n,"")})}),yo(Rp,function(e){r.getOpt(e).map(Yf.getValue).each(function(n){0<n.length&&io(e,Ev.createCommentEvent,{content:n,mode:t})})})])]),components:[r.asSpec(),Eg.secondary({text:n.translate(al.tc_reply_buttons_clear),eventName:A.some(Bp)}),Eg.primary({text:n.translate(al.tc_reply_buttons_save),eventName:A.some(Rp)})],apis:e}},Pp=function(){var r=le(Ig()),n=function(n){r.set(n(r.get()))};return{clearAll:function(){r.set(Ig())},recalibrate:function(r){n(function(n){return t=n,e=r.comments,{targetUid:t.targetUid,conversation:L(e,function(n,e){return{uid:n.uid,props:Ne({},n,{isDeleting:od.BeforeDelete,mode:t.targetUid.is(n.uid)?td.ExpandOrNone:td.CollapsedOrNone})}}),queue:[]};var t,e})},enqueuePatch:function(e,t){n(function(n){return Rg(n,[{uid:e,patch:t}])})},enqueuePatches:function(e){n(function(n){return Rg(n,e)})},setTargetUid:function(e){n(function(n){return Bg(n,A.some(e))})},clearTargetUid:function(){n(function(n){return Bg(n,A.none())})},processQueue:function(){return Hg(r.get()).map(function(n){var e=n.world,t=n.props;return r.set(e),t})},purge:function(t){n(function(n){var e=z(n.conversation,function(n){return n.uid!==t});return Ne({},n,{conversation:e})})},getProps:function(){return Fg(r.get())},adjust:function(e){n(function(n){return Rg(n,L(e,function(n){return{uid:n.uid,patch:"to-delete"===n.type?{isDeleting:od.PostDelete}:{}}}))})}}},Vp=function(n){return{type:"redraw-sidebar",view:n}},jp=function(n,e){if(n.conversation.uid!==e.conversation.uid)return Vp(e);var t,r,o=L(n.conversation.comments,function(n){return n.uid}),i=L(e.conversation.comments,function(n){return n.uid});return r=i,(t=o).length===r.length&&Z(t,function(n,e){return n===r[e]})?{type:"refresh-comments",comments:L(e.conversation.comments,function(n,e){return{uid:n.uid,patch:Ne({},n)}})}:0!==en(i,o).length?Vp(e):{type:"remove-comments",adjustments:L(o,function(n){return{type:V(i,n)?"to-remain":"to-delete",uid:n}})}},Lp=_i("tc-escapeInSidebar"),Up=function(n,t,r,e){var o=function(e){l.get().each(function(n){"comments"===n.type&&e(n.conversation.uid)})},u=Pp(),a=function(){u.processQueue().each(function(e){h(e),m.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})})},i=function(e){o(function(n){return e(n).get(function(n){n.fold(function(n){return n()},function(n){return n()})})})},c=function(n){n.get(function(n){n.fold(function(n){n()},function(n){u.setTargetUid(n.targetUid),n.fn()})})},s=yu({dom:{tag:"div",classes:n,styles:{position:"relative"}},behaviours:Fo([Ef.config({}),av({onEscape:function(n){return oo(n,Lp),A.some(!0)}}),Po("sidebar-events",[yo(Tg,function(n,e){u.enqueuePatch(e.event().uid(),e.event().patch())}),yo(Dg,function(n,e){u.purge(e.event().uid()),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().updateWith(n,e,{})})}),yo(Mg,function(n){a()}),yo(Lp,function(n,e){t.onEscape()}),yo(Ev.deleteConversationEvent,function(n,e){i(function(n){return r.deleteConversation(n,e.event().uid())})}),yo(Ev.deleteCommentEvent,function(n,e){i(function(n){return r.deleteComment(n,e.event().uid())})}),yo(Ev.editCommentEvent,function(n,e){o(function(n){c(r.editComment(n,e.event().uid(),e.event().content()))})}),yo(Ev.createCommentEvent,function(n,e){e.event().mode()===mp.Reply?o(function(n){c(r.reply(n,e.event().content()))}):c(r.createConversation(e.event().content()))})])])}),f=Fa(s),l=le(A.none()),d=function(n){Ef.set(s,[g.asSpec()].concat(n))},m=Ba(Fp([],{getSink:function(n){return g.getOpt(n)},universe:e})),g=Ba({dom:{tag:"div",styles:{"z-index":"100"}},behaviours:Fo([wf.config({})])}),v=Ba(Ip(mp.Start,e)),p=Ba(Ip(mp.Reply,e)),h=function(e){p.getOpt(s).each(function(n){n.getApis().updateWith(n,e,{})})},b=function(n){"splash"===n.view.type?(u.clearAll(),d([v.asSpec()])):"comments"===n.view.type&&(u.recalibrate(n.view.conversation),d([m.asSpec(),p.asSpec()]),m.getOpt(s).each(function(n){var e=u.getProps();h(e),n.getApis().setComments(n,e),n.getApis().scrollToEnd(n)}))};return{system:f,root:s,element:f.element,update:function(i){m.getOpt(s).bind(function(e){return l.get().map(function(n){return{convUi:e,pview:n}})}).fold(function(){return b(i)},function(n){n.convUi;var e,t,r=n.pview,o=(e=r,t=i.view,e.type!==t.type?Vp(t):"splash"===t.type?{type:"no-change"}:jp(e,t));switch(o.type){case"add-comment":b(i);break;case"no-change":break;case"redraw-sidebar":b(i);break;case"remove-comments":u.adjust(o.adjustments),a();break;case"refresh-comments":u.enqueuePatches(o.comments),a()}}),l.set(A.some(i.view)),Cf(s.element())&&i.grabFocus()&&p.getOpt(s).orThunk(function(){return v.getOpt(s)}).each(function(n){n.getApis().focusEditor(n)})},hasFocus:function(){return Lo(s.element()).isSome()},setReadonly:function(n){n&&f.broadcastOn([O()],{target:f.element()}),f.broadcastOn([tg],{readonly:n})},getSink:g.getOpt}},Wp="tc-delete-conversation-at-cursor",zp=function(n,e){n.execCommand(Wp,null,{conversationUid:e})},Gp=function(n,e,t,r){return n.fold(function(n){return Ie.error({message:e,error:n,refresh:r})},function(n){return t(n).fold(function(n){return Ie.error({message:n.permError,error:n.reason,refresh:r})},Ie.value)})},qp=function(n){return dn(n,"reason")?n.reason:""},Yp=function(o,r,i){var u=function(n){return function(){i().showError(n.message,n.error),n.refresh&&n.refresh()}};return{createConversation:function(n){return Le.wrap(o.create({content:n,createdAt:xv.nowISO8601()}).map(function(n){var e=Ie.value,t=y;return Gp(n,al.tc_create_problem,e,t).fold(function(n){return Ie.error(u(n))},function(n){return Ie.value({targetUid:n.conversationUid,fn:function(){r.annotator.annotate(Je(),{uid:n.conversationUid}),i().refreshSidebar(A.some(n.conversationUid),3)}})})}))},reply:function(r,n){return Le.wrap(o.reply({conversationUid:r,content:n,createdAt:xv.nowISO8601()}).map(function(n){var e=Ie.value,t=y;return Gp(n,al.tc_reply_problem,e,t).fold(function(n){return Ie.error(u(n))},function(n){return Ie.value({targetUid:n.commentUid,fn:function(){i().refreshSidebar(A.some(r),3)}})})}))},editComment:function(t,r,n){return Le.wrap(o.editComment({conversationUid:t,commentUid:r,content:n,modifiedAt:xv.nowISO8601()}).map(function(n){var e=y;return Gp(n,al.tc_edit_problem_comment,function(n){return n.canEdit?Ie.value(n):Ie.error({permError:al.tc_edit_unauthorised_comment,reason:qp(n)})},e).fold(function(n){return Ie.error(u(n))},function(n){return Ie.value({targetUid:r,fn:function(){i().refreshSidebar(A.some(t),4)}})})}))},deleteComment:function(e,n){return Le.wrap(o.deleteComment({conversationUid:e,commentUid:n}).map(function(n){return Gp(n,al.tc_delete_problem_comment,function(n){return n.canDelete?Ie.value(n):Ie.error({permError:al.tc_delete_unauthorised_comment,reason:qp(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Ie.error(u(n))},function(n){return Ie.value(function(){i().refreshSidebar(A.some(e),4)})})}))},deleteConversation:function(e){return Le.wrap(o.deleteConversation({conversationUid:e}).map(function(n){return Gp(n,al.tc_delete_problem_conversation,function(n){return n.canDelete?Ie.value(n):Ie.error({permError:al.tc_delete_unauthorised_conversation,reason:qp(n)})},function(){i().refreshSidebar(A.some(e),4)}).fold(function(n){return Ie.error(u(n))},function(n){return Ie.value(function(){zp(r,e),i().refreshSidebar(A.none(),2)})})}))}}};Me(function(n,e,t,r,o,i){var u,a,c,s,f,l,d=Yp(t,e,function(){return v}),m=n===w.Modern?(s=e,f=d,l=i,{createSidebar:function(){return Up(Og.classes.roots.modern,{onEscape:function(){return s.focus()}},f,l)},createController:Ze}):(u=e,a=d,c=i,{createSidebar:function(){return Up(Og.classes.roots.silver,{onEscape:function(){return u.focus()}},a,c)},createController:Ze}),g=m.createSidebar(),v=m.createController(t,r,e,g),p=function(n){g.system.broadcastOn([O()],{target:x.fromDom(n.target)})},h=k(x.fromDom(b.document),"mousedown",function(n){g.system.broadcastOn([O()],{target:n.target()})});e.on("mousedown",p),e.on("remove",function(){e.off("mousedown",p),h.unbind()});o({controller:v,attachTo:function(n){fe(n,g.element())}})})}(window);